(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const d of o)if(d.type==="childList")for(const l of d.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function r(o){const d={};return o.integrity&&(d.integrity=o.integrity),o.referrerPolicy&&(d.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?d.credentials="include":o.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function s(o){if(o.ep)return;o.ep=!0;const d=r(o);fetch(o.href,d)}})();const Ne={zh:{title:"È£ü‰πúÂ•Ω",subtitle:"ÂîîÁü•È£üÂí©ÔºüÁ≠âÊàëÂπ´‰Ω†ÊèÄÔºÅ",distanceTitle:"ÊÉ≥ÊêµÂæíÊ≠•ÂπæËÄêÔºü",priceTitle:"ÂÉπÈå¢È†êÁÆóÔºü",filterTitle:"‰ªäÊó•ÂîîÊÉ≥È£üÂí©Ôºü",findBtn:"Âπ´ÊàëÊèÄÔºÅ‚ú®",openMaps:"üó∫Ô∏è Âñ∫ Google Maps ÊâìÈñã",retry:"üé≤ ÂîîÂ§ö‰∏≠ÊÑèÔºüÊäΩÈÅéÈñìÔºÅ",backBtn:"üè† ËøîÂéª‰∏ªÈ†Å",loading:"ÊêúÂ∞ãÁ∑äÈôÑËøëÂ•ΩÂò¢È£ü... üîç",noResults:"ÈôÑËøëÊêµÂîîÂà∞ÈñãÈñÄÂòÖÈ§êÂª≥ÔºåË©¶‰∏ãÊêµÈÅ†Âï≤Ôºü",noFilteredResults:"ÊêµÂîîÂà∞Á¨¶ÂêàÁØ©ÈÅ∏Ê¢ù‰ª∂ÂòÖÈ§êÂª≥ÔºåË©¶‰∏ãË™øÊï¥‰∏ã„Äå‰ªäÊó•ÂîîÊÉ≥È£üÂí©„ÄçÔºüüîç",geoError:"ÊãéÂîîÂà∞‰Ω†ÂÄã‰ΩçÁΩÆÔºåË´ãÊ™¢Êü•‰∏ãÊ¨äÈôê„ÄÇüìç",noGeo:"‰Ω†ÂÄãÁÄèË¶ΩÂô®ÂîîÊîØÊè¥ÂèñÁî®Âú∞ÁêÜ‰ΩçÁΩÆ„ÄÇ",locationTitle:"ÊÉ≥ÊêµÈÇäÈ†≠Ôºü",searchPlaceholder:"üîç ÊêúÂ∞ãÂú∞Èªû",useCurrentLocation:"üìç ‰ΩøÁî®Áï∂Ââç‰ΩçÁΩÆ",installBtn:"ÂÆâË£ù App üì≤",iosInstallText:"ÈªûÊìäÊü•Áúã„ÄåÂÆâË£ù App„ÄçÊïôÂ≠∏ üì≤",iosInstallAlert:`ÊÉ≥Â•Ω‰ºº App ÂíÅÁî®„ÄåÈ£ü‰πúÂ•Ω„ÄçÔºü

1. Êí≥ÁÄèË¶ΩÂô®Â∫ïÈÉ®ÂàÜ‰∫´ÈÅ∏ÂñÆ (Ê≠£ÊñπÂΩ¢Âêë‰∏äÁÆ≠È†≠)
2. Âêë‰∏äÊéÉ‰∏¶ÈªûÈÅ∏„ÄåÂä†ÂÖ•‰∏ªÁï´Èù¢„Äç(Add to Home Screen)

ÊêûÊéÇÔºÅ‚ú®`,categories:{chinese:"üçö ‰∏≠È§ê",japanese:"üç£ Êó•Êú¨Ëèú",korean:"üá∞üá∑ ÈüìÂúãËèú",western:"üçï Ë•øÈ§ê",se_asian:"üç≤ Êù±Âçó‰∫û",noodles:"üçú Á≤âÈ∫µ",spicy:"üå∂Ô∏è Ëæ£Âò¢",hotpot_bbq:"üî• ÁÅ´Èçã/ÁáíÁÉ§",dim_sum:"ü•ü ÈªûÂøÉ/È£≤Ëå∂",dessert:"üçß ÁîúÂìÅ/Á≥ñÊ∞¥",fast_food:"üçî Âø´È§ê/Â∞èÈ£ü",cafe_light:"‚òï ÂíñÂï°/ËºïÈ£ü"},unknownName:"ÂêçÁ®±‰∏çË©≥",noAddress:"Âú∞ÂùÄ‰∏çË©≥",ratingNew:"‚≠ê Êñ∞ÈñãÂºµÔºÅ",priceFree:"ÂÖçË≤ª",walkMins:"Ê≠•Ë°åÁ¥Ñ ${mins} ÂàÜÈêò",shareBtn:"üì§ ÂàÜ‰∫´È§êÂª≥",shareText:"ÊàëÂñ∫„ÄåÈ£ü‰πúÂ•Ω„ÄçÊäΩ‰∏≠ÂíóÂë¢ÈñìÔºö${name}ÔºÅ‰∏ÄÈΩäÂéªË©¶‰∏ãÔºüü•ó",includeClosed:"ÂåÖÂê´Â∑≤ÈóúÈñÄÈ§êÂª≥ üåô",excludeClosed:"Âè™ÈÅ∏ÁáüÊ•≠‰∏≠È§êÂª≥ ‚òÄÔ∏è",reviews:"È£üË©ï",viewAllReviews:"Êü•ÁúãÂÖ®ÈÉ®",photosTitle:"Áõ∏Áâá",viewAllPhotos:"Êü•ÁúãÂÖ®ÈÉ®"},en:{title:"What to Eat",subtitle:"Don't know? Let me pick!",distanceTitle:"Walking Distance",priceTitle:"Price Range",filterTitle:"What do you NOT want to eat?",findBtn:"Pick for me! ‚ú®",openMaps:"üó∫Ô∏è Open in Google Maps",retry:"üé≤ Not this one? Re-roll!",backBtn:"üè† Back to Home",loading:"Searching for delicious food... üîç",noResults:"No open restaurants found nearby. Try moving a bit?",noFilteredResults:"No restaurants match your filters. Try adjusting them! üîç",geoError:"Unable to find location. Check permissions.",noGeo:"Geolocation not supported by this browser.",locationTitle:"Where to eat?",searchPlaceholder:"üîç Search Location",useCurrentLocation:"üìç Use Current Location",installBtn:"Install App üì≤",iosInstallText:"How to Install App üì≤",iosInstallAlert:`Want to use 'What to Eat' like an App?

1. Tap the Share button in Safari (square with up arrow)
2. Scroll down and tap 'Add to Home Screen'

All set! ‚ú®`,categories:{chinese:"üçö Chinese",japanese:"üç£ Japanese",korean:"üá∞üá∑ Korean",western:"üçï Western",se_asian:"üç≤ SE Asian",noodles:"üçú Noodles",spicy:"üå∂Ô∏è Spicy",hotpot_bbq:"üî• Hotpot/BBQ",dim_sum:"ü•ü Dim Sum",dessert:"üçß Dessert",fast_food:"üçî Fast Food",cafe_light:"‚òï Cafe/Light"},unknownName:"Unknown",noAddress:"Address Unknown",ratingNew:"‚≠ê New!",priceFree:"Free",walkMins:"üö∂ ${mins} min walk",shareBtn:"üì§ Share",shareText:"I picked this on What to Eat: ${name}! Want to try? ü•ó",includeClosed:"Includes Closed Restaurants üåô",excludeClosed:"Open Restaurants Only ‚òÄÔ∏è",reviews:"Reviews",viewAllReviews:"View All",photosTitle:"Photos",viewAllPhotos:"View All"},ja:{title:"„É°„Ç∑Ê±∫",subtitle:"Ëø∑„Å£„Åü„Çâ„ÄÅÁßÅ„Å´ÈÅ∏„Å∞„Åõ„Å¶ÔºÅ",distanceTitle:"ÂæíÊ≠©‰ΩïÂàÜÔºü",priceTitle:"‰∫àÁÆó„ÅØÔºü",filterTitle:"‰ªä„ÅØÈ£ü„Åπ„Åü„Åè„Å™„ÅÑ„ÇÇ„ÅÆ„ÅØÔºü",findBtn:"ÈÅ∏„Çì„ÅßÔºÅ ‚ú®",openMaps:"üó∫Ô∏è Google„Éû„ÉÉ„Éó„ÅßÈñã„Åè",retry:"üé≤ ‰ªñ„ÅÆ„Åå„ÅÑ„ÅÑÔºÅ",backBtn:"üè† „Éõ„Éº„É†„Å´Êàª„Çã",loading:"Ëøë„Åè„ÅÆÁæéÂë≥„Åó„ÅÑÂ∫ó„ÇíÊé¢„Åó„Å¶„ÅÑ„Åæ„Åô... üîç",noResults:"Ëøë„Åè„Å´Âñ∂Ê•≠‰∏≠„ÅÆÂ∫ó„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ",noFilteredResults:"Êù°‰ª∂„Å´Âêà„ÅÜÂ∫ó„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ„Éï„Ç£„É´„Çø„Éº„ÇíË™øÊï¥„Åó„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇüîç",geoError:"‰ΩçÁΩÆÊÉÖÂ†±„ÇíÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì„ÄÇË®≠ÂÆö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",noGeo:"„Åä‰Ωø„ÅÑ„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØ‰ΩçÁΩÆÊÉÖÂ†±„Çí„Çµ„Éù„Éº„Éà„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ",locationTitle:"„Å©„ÅÆËæ∫„ÅßÈ£ü„Åπ„ÇãÔºü",searchPlaceholder:"üîç Â†¥ÊâÄ„ÇíÊ§úÁ¥¢",useCurrentLocation:"üìç ÁèæÂú®Âú∞„Çí‰ΩøÁî®",installBtn:"„Ç¢„Éó„É™„Çí„Ç§„É≥„Çπ„Éà„Éº„É´ üì≤",iosInstallText:"„Ç¢„Éó„É™„ÅÆ„Ç§„É≥„Çπ„Éà„Éº„É´ÊñπÊ≥ï üì≤",iosInstallAlert:`„Äå‰ΩïÈ£ü„Åπ„ÇãÔºü„Äç„Çí„Ç¢„Éó„É™„ÅÆ„Çà„ÅÜ„Å´‰Ωø„ÅÜÊñπÊ≥ïÔºö

1. Safari „ÅÆÂÖ±Êúâ„Ç¢„Ç§„Ç≥„É≥ÔºàÂõõËßí„Å´‰∏äÁü¢Âç∞Ôºâ„Çí„Çø„ÉÉ„Éó
2. ‰∏ã„Å´„Çπ„ÇØ„É≠„Éº„É´„Åó„Å¶„Äå„Éõ„Éº„É†ÁîªÈù¢„Å´ËøΩÂä†„Äç„Çí„Çø„ÉÉ„Éó

ÂÆå‰∫Ü„Åß„ÅôÔºÅ‚ú®`,categories:{chinese:"üçö ‰∏≠ËèØÊñôÁêÜ",japanese:"üç£ Êó•Êú¨ÊñôÁêÜ",korean:"üá∞üá∑ ÈüìÂõΩÊñôÁêÜ",western:"üçï Ê¥ãÈ£ü",se_asian:"üç≤ Êù±Âçó‰∫û",noodles:"üçú È∫∫È°û",spicy:"üå∂Ô∏è Ëæõ„ÅÑÊñôÁêÜ",hotpot_bbq:"üî• ÁÅ´Èçã/ÁÑºËÇâ",dim_sum:"ü•ü ÁÇπÂøÉ",dessert:"üçß „Éá„Ç∂„Éº„Éà",fast_food:"üçî „Éï„Ç°„Çπ„Éà„Éï„Éº„Éâ",cafe_light:"‚òï „Ç´„Éï„Çß/ËªΩÈ£ü"},unknownName:"‰∏çÊòé",noAddress:"‰ΩèÊâÄ‰∏çÊòé",ratingNew:"‚≠ê Êñ∞Ë¶è„Ç™„Éº„Éó„É≥ÔºÅ",priceFree:"ÁÑ°Êñô",walkMins:"üö∂ ÂæíÊ≠© ${mins} ÂàÜ",shareBtn:"üì§ „Ç∑„Çß„Ç¢",shareText:"„Äå„É°„Ç∑Ê±∫„Äç„Åß„Åì„Çå„ÇíÈÅ∏„Çì„Å†„ÇàÔºö${name}ÔºÅ‰∏ÄÁ∑í„Å´„Å©„ÅÜÔºüü•ó",includeClosed:"Âñ∂Ê•≠ÊôÇÈñìÂ§ñ„ÇÇÂê´„ÇÄ üåô",excludeClosed:"Âñ∂Ê•≠‰∏≠„ÅÆ„Åø ‚òÄÔ∏è",reviews:"Âè£„Ç≥„Éü",viewAllPhotos:"„ÇÇ„Å£„Å®Ë¶ã„Çã",photosTitle:"ÂÜôÁúü",viewAllReviews:"„ÇÇ„Å£„Å®Ë¶ã„Çã"}},u=e=>document.getElementById(e);function Ue(e={}){return new Promise((t,r)=>{if(!navigator.geolocation){r(new Error("GEOLOCATION_NOT_SUPPORTED"));return}navigator.geolocation.getCurrentPosition(t,r,{enableHighAccuracy:!0,timeout:5e3,maximumAge:0,...e})})}const ae={chinese:["chinese_restaurant","chinese","cantonese","shanghainese","sichuan","dim sum","congee","‰∏≠Ëèú","‰∏≠Âºè","Á≤µËèú","ÈªûÂøÉ","Á≤•"],japanese:["japanese_restaurant","sushi_restaurant","ramen_restaurant","japanese","sushi","ramen","izakaya","udon","soba","yakitori","tonkatsu","Êó•Êú¨","Â£ΩÂè∏","ÊãâÈ∫µ","Â±ÖÈÖíÂ±ã","ÁÉèÂÜ¨","ÁáíÈ≥•"],korean:["korean_restaurant","korean","kimchi","bibimbap","bbq","ÈüìÂúã","ÈüìÂºè","Ê≥°Ëèú","È£ØÂç∑","ÈüìÁáí"],western:["italian_restaurant","french_restaurant","american_restaurant","hamburger_restaurant","pizza_restaurant","steak_house","steak","italian","french","burger","pasta","pizza","western","mexican","spanish","Ë•øÈ§ê","ÊÑèÂºè","Ê≥ïÂºè","Êº¢Â†°","ËñÑÈ§Ö","ÁâõÊâí"],se_asian:["thai_restaurant","vietnamese_restaurant","thai","vietnamese","malaysian","singaporean","indonesian","Ê≥∞Âúã","Ë∂äÂçó","ÊòüÈ¶¨","Âç∞Â∞º","Ê≥∞Âºè","Ë∂äÂºè"],noodles:["ramen_restaurant","noodle","ramen","udon","pho","Á±≥Á∑ö","ÊãâÈ∫µ","È∫µ","Á≤â","Ê≤≥"],spicy:["spicy","sichuan","mala","chili","Â∑ùËèú","È∫ªËæ£","Ëæ£","Ê∞¥ÁÖÆ","ÈÖ∏Ëæ£"],hotpot_bbq:["barbecue_restaurant","steak_house","hot pot","hotpot","bbq","barbecue","grill","yakiniku","ÁÅ´Èçã","ÈõûÁÖ≤","ÁáíËÇâ","ÈüìÁáí","ÁáíÁÉ§","‰∏≤Ááí"],dim_sum:["chinese_restaurant","dim sum","yum cha","dumpling","ÈªûÂøÉ","È£≤Ëå∂","È§ÉÂ≠ê","ÁõÖÈ£Ø"],dessert:["bakery","ice_cream_shop","dessert","sugar","sweet","bakery","cake","ice cream","Á≥ñÊ∞¥","Áîú","Èõ™Á≥ï","ÂÜ∞","ËõãÁ≥ï","È§Ö"],fast_food:["fast_food_restaurant","hamburger_restaurant","sandwich_shop","fast food","mcdonald","kfc","burger","sandwich","Âø´È§ê","Â∞èÈ£ü","Êº¢Â†°","‰∏âÊñáÊ≤ª"],cafe_light:["cafe","coffee_shop","bakery","cafe","coffee","sandwich","salad","breakfast","brunch","ËºïÈ£ü","ÂíñÂï°","Ê≤ôÂæã","Êó©È§ê","Êó©ÂçàÈ§ê","ÊñáÈùí"]},q=["id","displayName","location","rating","userRatingCount","regularOpeningHours","priceLevel","businessStatus","types"],re=["id","formattedAddress","regularOpeningHours","nationalPhoneNumber","photos","reviews","googleMapsURI"],se={PRICE_LEVEL_FREE:{val:"0",label:e=>e.priceFree},PRICE_LEVEL_INEXPENSIVE:{val:"1",label:()=>"$"},PRICE_LEVEL_MODERATE:{val:"2",label:()=>"$$"},PRICE_LEVEL_EXPENSIVE:{val:"3",label:()=>"$$$"},PRICE_LEVEL_VERY_EXPENSIVE:{val:"4",label:()=>"$$$$"}},A={0:"PRICE_LEVEL_FREE",1:"PRICE_LEVEL_INEXPENSIVE",2:"PRICE_LEVEL_MODERATE",3:"PRICE_LEVEL_EXPENSIVE",4:"PRICE_LEVEL_VERY_EXPENSIVE"},H={DEFAULT_SEARCH_RADIUS_MULTIPLIER:80,DEFAULT_MINS:5,HAPTIC_FEEDBACK_DURATION:{SHORT:30}},te=111320;function K(e,t){return{name:typeof e.displayName=="string"?e.displayName:e.displayName?.text||t.unknownName,rating:e.rating,userRatingCount:e.userRatingCount||0,vicinity:e.formattedAddress||e.vicinity||t.noAddress,place_id:e.id||e.place_id,id:e.id||e.place_id,types:e.types||[],priceLevel:e.priceLevel,phone:e.nationalPhoneNumber,businessStatus:e.businessStatus,location:e.location,openingHours:e.regularOpeningHours,isOpen:null,durationText:null,durationValue:null,photos:e.photos||[],reviews:e.reviews||[],googleMapsURI:e.googleMapsURI}}async function oe(e){e.UI.triggerHaptic(50),e.UI.showScreen("loading-screen"),e.Data.history=[];const t=e.translations[e.currentLang];try{let r;e.Data.manualLocation?r={coords:{latitude:e.Data.manualLocation.lat,longitude:e.Data.manualLocation.lng}}:r=await Ue();const{latitude:s,longitude:o}=r.coords;e.Data.userPos={lat:s,lng:o};const{Place:d}=await google.maps.importLibrary("places"),l=await ie(d,e.Data.userPos,e.Config.radius);if(!l||l.length===0){alert(t.noResults),e.UI.showScreen("main-flow");return}const c=await le(l,e.Data.userPos,e);if(c.length===0){alert(t.noFilteredResults),e.UI.showScreen("main-flow");return}e.Data.candidates=c;const i=c[Math.floor(Math.random()*c.length)];e.Data.currentPlace=await ce(d,i,e),e.UI.startSlotAnimation(e)}catch(r){console.error("Search Error:",r),Be(r,t,e)}}async function ie(e,t,r){const s=r*.6,o=s/te,d=s/(te*Math.cos(t.lat*Math.PI/180)),l=[{lat:t.lat,lng:t.lng},{lat:t.lat-o,lng:t.lng-d},{lat:t.lat+o,lng:t.lng-d},{lat:t.lat-o,lng:t.lng+d},{lat:t.lat+o,lng:t.lng+d}],c=[],i=new Set,m=[["asian_restaurant","chinese_restaurant","indian_restaurant","indonesian_restaurant","japanese_restaurant","korean_restaurant","ramen_restaurant","sushi_restaurant","thai_restaurant","vietnamese_restaurant","lebanese_restaurant","turkish_restaurant","middle_eastern_restaurant","afghani_restaurant","african_restaurant"],["american_restaurant","barbecue_restaurant","brazilian_restaurant","french_restaurant","greek_restaurant","italian_restaurant","mediterranean_restaurant","mexican_restaurant","pizza_restaurant","seafood_restaurant","spanish_restaurant","steak_house","buffet_restaurant","fine_dining_restaurant","restaurant","bar_and_grill","vegan_restaurant","vegetarian_restaurant"],["bakery","breakfast_restaurant","brunch_restaurant","cafe","cafeteria","coffee_shop","dessert_restaurant","dessert_shop","diner","donut_shop","fast_food_restaurant","food_court","hamburger_restaurant","ice_cream_shop","juice_shop","meal_delivery","meal_takeaway","sandwich_shop","tea_house","bagel_shop","acai_shop","confectionery","chocolate_factory","chocolate_shop","candy_store"]];for(const _ of m)(await Promise.all(l.map(async I=>{const S={locationRestriction:{center:I,radius:r},includedPrimaryTypes:_,fields:q,maxResultCount:20,rankPreference:"POPULARITY"};try{const{places:O}=await e.searchNearby(S);return O||[]}catch(O){return console.error("Fetch point error:",O),[]}}))).forEach(I=>{I.forEach(S=>{S&&S.id&&!i.has(S.id)&&(i.add(S.id),c.push(S))})});return c}async function le(e,t,r){const s=r.translations[r.currentLang];let d=(await Promise.all(e.map(async i=>{const m=K(i,s);try{m.openingHours?.periods&&(m.isOpen=Fe(m.openingHours.periods)),m.isOpen===null&&(m.isOpen=await i.isOpen()),m.isOpen===null&&(m.isOpen=m.openingHours?.openNow)}catch{m.isOpen=null}return m}))).filter(i=>i.businessStatus!=="OPERATIONAL"&&i.businessStatus?!1:r.Config.includeClosed?!0:i.isOpen!==!1);const l=await de(t,d);let c=l.filter(i=>i.durationValue===null||i.durationValue/60<=r.Config.mins);return c.length===0&&(c=l.sort((i,m)=>(i.durationValue||9999)-(m.durationValue||9999)).slice(0,3)),c.filter(i=>{const m=(i.name||"").toLowerCase(),_=i.types||[];if(Array.from(r.Config.excluded).some(I=>(ae[I]||[]).some(O=>m.includes(O)||_.some(V=>V.toLowerCase().includes(O)))))return!1;if(i.priceLevel!==void 0&&i.priceLevel!==null){let I=i.priceLevel;A[I]&&(I=A[I]);const S=se[I];if(S&&r.Config.prices.size>0&&!r.Config.prices.has(S.val))return!1}return!0})}function Fe(e){if(!e||!Array.isArray(e)||e.length===0)return null;if(e.length===1&&!e[0].close)return!0;const t=new Date,r=t.getDay()*1440+t.getHours()*60+t.getMinutes(),s=10080;for(const o of e){if(!o.open||!o.close)continue;const d=Number(o.open.day)*1440+Number(o.open.hour)*60+Number(o.open.minute);let l=Number(o.close.day)*1440+Number(o.close.hour)*60+Number(o.close.minute);if(l<=d&&(l+=s),r>=d&&r<l||r+s>=d&&r+s<l)return!0}return!1}async function ce(e,t,r){if(!t||!t.place_id)return t;const s=`place_detail_${t.place_id}`,o=Date.now(),d=1440*60*1e3,l=c=>c&&c.map(i=>({...i,getURI:m=>i.cachedURI||""}));try{const c=localStorage.getItem(s);if(c){const{data:i,timestamp:m}=JSON.parse(c);if(o-m<d){i.photos&&(i.photos=l(i.photos)),delete i.durationText,delete i.durationValue,delete i.distanceText,delete i.distanceValue;const{durationText:_,durationValue:p}=t;return Object.assign(t,i),_&&(t.durationText=_),p&&(t.durationValue=p),t}}}catch(c){console.warn("Cache read error:",c)}try{const c=new e({id:t.place_id});await c.fetchFields({fields:[...q,...re]});const i=K(c,r.translations[r.currentLang]);c.photos&&c.photos.length>0&&(i.photos=c.photos.map(p=>({cachedURI:p.getURI({maxHeight:1e3}),widthPx:p.widthPx,heightPx:p.heightPx,authorAttributions:p.authorAttributions})));const{durationText:m,durationValue:_}=t;Object.assign(t,i),m&&(t.durationText=m),_&&(t.durationValue=_),localStorage.setItem(s,JSON.stringify({data:i,timestamp:o})),t.photos&&(t.photos=l(t.photos))}catch(c){console.error("Error fetching place details:",c)}return t}function Be(e,t,r){e.message==="GEOLOCATION_NOT_SUPPORTED"?alert(t.noGeo):e.code===1?alert(t.geoError):alert("Error: "+e.message),r.UI.showScreen("main-flow")}async function de(e,t){if(t.length===0)return[];const r=25,s=[];for(let l=0;l<t.length;l+=r)s.push(t.slice(l,l+r));const o=new google.maps.DistanceMatrixService;return(await Promise.all(s.map(l=>new Promise(c=>{o.getDistanceMatrix({origins:[e],destinations:l.map(i=>i.location),travelMode:google.maps.TravelMode.WALKING,unitSystem:google.maps.UnitSystem.METRIC},(i,m)=>{if(m!=="OK"){c(l.map(p=>({...p,durationText:null,durationValue:null})));return}const _=i.rows[0].elements;c(l.map((p,I)=>({...p,durationText:_[I].status==="OK"?_[I].duration.text:null,durationValue:_[I].status==="OK"?_[I].duration.value:null})))})})))).flat()}async function ue(e){if(e.UI.triggerHaptic([50,30,50]),e.Data.candidates.length===0)return oe(e);let t=e.Data.candidates;if(t.length>1){const d=new Set(e.Data.history||[]),l=t.filter(c=>!d.has(c.place_id));if(l.length>0)t=l;else if(e.Data.lastPickedId){const c=t.filter(i=>i.place_id!==e.Data.lastPickedId);c.length>0&&(t=c)}}let r=t[Math.floor(Math.random()*t.length)];const{Place:s}=await google.maps.importLibrary("places"),o=await ce(s,r,e);e.UI.showResult(e,o)}async function He(e){const t=e.Data.params.get("resId");if(t){window.history.replaceState({},document.title,window.location.pathname),e.UI.showScreen("loading-screen");try{const{Place:r}=await google.maps.importLibrary("places"),s=new r({id:t});await s.fetchFields({fields:[...q,...re]});const o=e.Data.params.get("lat"),d=e.Data.params.get("lng");o&&d&&(e.Data.userPos={lat:parseFloat(o),lng:parseFloat(d)});const l=e.translations[e.currentLang],c=K(s,l);if(e.Data.userPos&&c.location){const[i]=await de(e.Data.userPos,[c]);c.durationValue=i.durationValue,c.durationText=i.durationText}if(e.Data.userPos){const i=await ie(r,e.Data.userPos,e.Config.radius);i&&i.length>0&&(e.Data.candidates=await le(i,e.Data.userPos,e))}e.UI.showResult(e,c,{fromShare:!0})}catch(r){console.error("Session restoration failed:",r),e.UI.showScreen("main-flow")}}}function Ve(){const e=()=>{const t=Date.now(),r=1440*60*1e3;let s=0;try{for(let o=0;o<localStorage.length;o++){const d=localStorage.key(o);if(d&&d.startsWith("place_detail_"))try{const l=localStorage.getItem(d);if(l){const{timestamp:c}=JSON.parse(l);t-c>r&&(localStorage.removeItem(d),s++,o--)}}catch{localStorage.removeItem(d)}}}catch(o){console.warn("Garbage collection failed:",o)}};"requestIdleCallback"in window?requestIdleCallback(e,{timeout:5e3}):setTimeout(e,2e3)}var G={};(function e(t,r,s,o){var d=!!(t.Worker&&t.Blob&&t.Promise&&t.OffscreenCanvas&&t.OffscreenCanvasRenderingContext2D&&t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype.transferControlToOffscreen&&t.URL&&t.URL.createObjectURL),l=typeof Path2D=="function"&&typeof DOMMatrix=="function",c=(function(){if(!t.OffscreenCanvas)return!1;try{var a=new OffscreenCanvas(1,1),n=a.getContext("2d");n.fillRect(0,0,1,1);var h=a.transferToImageBitmap();n.createPattern(h,"no-repeat")}catch{return!1}return!0})();function i(){}function m(a){var n=r.exports.Promise,h=n!==void 0?n:t.Promise;return typeof h=="function"?new h(a):(a(i,i),null)}var _=(function(a,n){return{transform:function(h){if(a)return h;if(n.has(h))return n.get(h);var g=new OffscreenCanvas(h.width,h.height),w=g.getContext("2d");return w.drawImage(h,0,0),n.set(h,g),g},clear:function(){n.clear()}}})(c,new Map),p=(function(){var a=Math.floor(16.666666666666668),n,h,g={},w=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(n=function(v){var y=Math.random();return g[y]=requestAnimationFrame(function f(b){w===b||w+a-1<b?(w=b,delete g[y],v()):g[y]=requestAnimationFrame(f)}),y},h=function(v){g[v]&&cancelAnimationFrame(g[v])}):(n=function(v){return setTimeout(v,a)},h=function(v){return clearTimeout(v)}),{frame:n,cancel:h}})(),I=(function(){var a,n,h={};function g(w){function v(y,f){w.postMessage({options:y||{},callback:f})}w.init=function(f){var b=f.transferControlToOffscreen();w.postMessage({canvas:b},[b])},w.fire=function(f,b,E){if(n)return v(f,null),n;var P=Math.random().toString(36).slice(2);return n=m(function(L){function M(x){x.data.callback===P&&(delete h[P],w.removeEventListener("message",M),n=null,_.clear(),E(),L())}w.addEventListener("message",M),v(f,P),h[P]=M.bind(null,{data:{callback:P}})}),n},w.reset=function(){w.postMessage({reset:!0});for(var f in h)h[f](),delete h[f]}}return function(){if(a)return a;if(!s&&d){var w=["var CONFETTI, SIZE = {}, module = {};","("+e.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{a=new Worker(URL.createObjectURL(new Blob([w])))}catch(v){return typeof console<"u"&&typeof console.warn=="function"&&console.warn("üéä Could not load worker",v),null}g(a)}return a}})(),S={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function O(a,n){return n?n(a):a}function V(a){return a!=null}function T(a,n,h){return O(a&&V(a[n])?a[n]:S[n],h)}function he(a){return a<0?0:Math.floor(a)}function fe(a,n){return Math.floor(Math.random()*(n-a))+a}function $(a){return parseInt(a,16)}function ge(a){return a.map(me)}function me(a){var n=String(a).replace(/[^0-9a-f]/gi,"");return n.length<6&&(n=n[0]+n[0]+n[1]+n[1]+n[2]+n[2]),{r:$(n.substring(0,2)),g:$(n.substring(2,4)),b:$(n.substring(4,6))}}function pe(a){var n=T(a,"origin",Object);return n.x=T(n,"x",Number),n.y=T(n,"y",Number),n}function we(a){a.width=document.documentElement.clientWidth,a.height=document.documentElement.clientHeight}function ve(a){var n=a.getBoundingClientRect();a.width=n.width,a.height=n.height}function ye(a){var n=document.createElement("canvas");return n.style.position="fixed",n.style.top="0px",n.style.left="0px",n.style.pointerEvents="none",n.style.zIndex=a,n}function be(a,n,h,g,w,v,y,f,b){a.save(),a.translate(n,h),a.rotate(v),a.scale(g,w),a.arc(0,0,1,y,f,b),a.restore()}function Ce(a){var n=a.angle*(Math.PI/180),h=a.spread*(Math.PI/180);return{x:a.x,y:a.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:a.startVelocity*.5+Math.random()*a.startVelocity,angle2D:-n+(.5*h-Math.random()*h),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:a.color,shape:a.shape,tick:0,totalTicks:a.ticks,decay:a.decay,drift:a.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:a.gravity*3,ovalScalar:.6,scalar:a.scalar,flat:a.flat}}function _e(a,n){n.x+=Math.cos(n.angle2D)*n.velocity+n.drift,n.y+=Math.sin(n.angle2D)*n.velocity+n.gravity,n.velocity*=n.decay,n.flat?(n.wobble=0,n.wobbleX=n.x+10*n.scalar,n.wobbleY=n.y+10*n.scalar,n.tiltSin=0,n.tiltCos=0,n.random=1):(n.wobble+=n.wobbleSpeed,n.wobbleX=n.x+10*n.scalar*Math.cos(n.wobble),n.wobbleY=n.y+10*n.scalar*Math.sin(n.wobble),n.tiltAngle+=.1,n.tiltSin=Math.sin(n.tiltAngle),n.tiltCos=Math.cos(n.tiltAngle),n.random=Math.random()+2);var h=n.tick++/n.totalTicks,g=n.x+n.random*n.tiltCos,w=n.y+n.random*n.tiltSin,v=n.wobbleX+n.random*n.tiltCos,y=n.wobbleY+n.random*n.tiltSin;if(a.fillStyle="rgba("+n.color.r+", "+n.color.g+", "+n.color.b+", "+(1-h)+")",a.beginPath(),l&&n.shape.type==="path"&&typeof n.shape.path=="string"&&Array.isArray(n.shape.matrix))a.fill(Le(n.shape.path,n.shape.matrix,n.x,n.y,Math.abs(v-g)*.1,Math.abs(y-w)*.1,Math.PI/10*n.wobble));else if(n.shape.type==="bitmap"){var f=Math.PI/10*n.wobble,b=Math.abs(v-g)*.1,E=Math.abs(y-w)*.1,P=n.shape.bitmap.width*n.scalar,L=n.shape.bitmap.height*n.scalar,M=new DOMMatrix([Math.cos(f)*b,Math.sin(f)*b,-Math.sin(f)*E,Math.cos(f)*E,n.x,n.y]);M.multiplySelf(new DOMMatrix(n.shape.matrix));var x=a.createPattern(_.transform(n.shape.bitmap),"no-repeat");x.setTransform(M),a.globalAlpha=1-h,a.fillStyle=x,a.fillRect(n.x-P/2,n.y-L/2,P,L),a.globalAlpha=1}else if(n.shape==="circle")a.ellipse?a.ellipse(n.x,n.y,Math.abs(v-g)*n.ovalScalar,Math.abs(y-w)*n.ovalScalar,Math.PI/10*n.wobble,0,2*Math.PI):be(a,n.x,n.y,Math.abs(v-g)*n.ovalScalar,Math.abs(y-w)*n.ovalScalar,Math.PI/10*n.wobble,0,2*Math.PI);else if(n.shape==="star")for(var C=Math.PI/2*3,R=4*n.scalar,D=8*n.scalar,k=n.x,F=n.y,B=5,N=Math.PI/B;B--;)k=n.x+Math.cos(C)*D,F=n.y+Math.sin(C)*D,a.lineTo(k,F),C+=N,k=n.x+Math.cos(C)*R,F=n.y+Math.sin(C)*R,a.lineTo(k,F),C+=N;else a.moveTo(Math.floor(n.x),Math.floor(n.y)),a.lineTo(Math.floor(n.wobbleX),Math.floor(w)),a.lineTo(Math.floor(v),Math.floor(y)),a.lineTo(Math.floor(g),Math.floor(n.wobbleY));return a.closePath(),a.fill(),n.tick<n.totalTicks}function Ee(a,n,h,g,w){var v=n.slice(),y=a.getContext("2d"),f,b,E=m(function(P){function L(){f=b=null,y.clearRect(0,0,g.width,g.height),_.clear(),w(),P()}function M(){s&&!(g.width===o.width&&g.height===o.height)&&(g.width=a.width=o.width,g.height=a.height=o.height),!g.width&&!g.height&&(h(a),g.width=a.width,g.height=a.height),y.clearRect(0,0,g.width,g.height),v=v.filter(function(x){return _e(y,x)}),v.length?f=p.frame(M):L()}f=p.frame(M),b=L});return{addFettis:function(P){return v=v.concat(P),E},canvas:a,promise:E,reset:function(){f&&p.cancel(f),b&&b()}}}function J(a,n){var h=!a,g=!!T(n||{},"resize"),w=!1,v=T(n,"disableForReducedMotion",Boolean),y=d&&!!T(n||{},"useWorker"),f=y?I():null,b=h?we:ve,E=a&&f?!!a.__confetti_initialized:!1,P=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,L;function M(C,R,D){for(var k=T(C,"particleCount",he),F=T(C,"angle",Number),B=T(C,"spread",Number),N=T(C,"startVelocity",Number),Pe=T(C,"decay",Number),Me=T(C,"gravity",Number),Te=T(C,"drift",Number),X=T(C,"colors",ge),xe=T(C,"ticks",Number),Y=T(C,"shapes"),Re=T(C,"scalar"),De=!!T(C,"flat"),Q=pe(C),ee=k,W=[],ke=a.width*Q.x,Oe=a.height*Q.y;ee--;)W.push(Ce({x:ke,y:Oe,angle:F,spread:B,startVelocity:N,color:X[ee%X.length],shape:Y[fe(0,Y.length)],ticks:xe,decay:Pe,gravity:Me,drift:Te,scalar:Re,flat:De}));return L?L.addFettis(W):(L=Ee(a,W,b,R,D),L.promise)}function x(C){var R=v||T(C,"disableForReducedMotion",Boolean),D=T(C,"zIndex",Number);if(R&&P)return m(function(N){N()});h&&L?a=L.canvas:h&&!a&&(a=ye(D),document.body.appendChild(a)),g&&!E&&b(a);var k={width:a.width,height:a.height};f&&!E&&f.init(a),E=!0,f&&(a.__confetti_initialized=!0);function F(){if(f){var N={getBoundingClientRect:function(){if(!h)return a.getBoundingClientRect()}};b(N),f.postMessage({resize:{width:N.width,height:N.height}});return}k.width=k.height=null}function B(){L=null,g&&(w=!1,t.removeEventListener("resize",F)),h&&a&&(document.body.contains(a)&&document.body.removeChild(a),a=null,E=!1)}return g&&!w&&(w=!0,t.addEventListener("resize",F,!1)),f?f.fire(C,k,B):M(C,k,B)}return x.reset=function(){f&&f.reset(),L&&L.reset()},x}var j;function Z(){return j||(j=J(null,{useWorker:!0,resize:!0})),j}function Le(a,n,h,g,w,v,y){var f=new Path2D(a),b=new Path2D;b.addPath(f,new DOMMatrix(n));var E=new Path2D;return E.addPath(b,new DOMMatrix([Math.cos(y)*w,Math.sin(y)*w,-Math.sin(y)*v,Math.cos(y)*v,h,g])),E}function Ie(a){if(!l)throw new Error("path confetti are not supported in this browser");var n,h;typeof a=="string"?n=a:(n=a.path,h=a.matrix);var g=new Path2D(n),w=document.createElement("canvas"),v=w.getContext("2d");if(!h){for(var y=1e3,f=y,b=y,E=0,P=0,L,M,x=0;x<y;x+=2)for(var C=0;C<y;C+=2)v.isPointInPath(g,x,C,"nonzero")&&(f=Math.min(f,x),b=Math.min(b,C),E=Math.max(E,x),P=Math.max(P,C));L=E-f,M=P-b;var R=10,D=Math.min(R/L,R/M);h=[D,0,0,D,-Math.round(L/2+f)*D,-Math.round(M/2+b)*D]}return{type:"path",path:n,matrix:h}}function Se(a){var n,h=1,g="#000000",w='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof a=="string"?n=a:(n=a.text,h="scalar"in a?a.scalar:h,w="fontFamily"in a?a.fontFamily:w,g="color"in a?a.color:g);var v=10*h,y=""+v+"px "+w,f=new OffscreenCanvas(v,v),b=f.getContext("2d");b.font=y;var E=b.measureText(n),P=Math.ceil(E.actualBoundingBoxRight+E.actualBoundingBoxLeft),L=Math.ceil(E.actualBoundingBoxAscent+E.actualBoundingBoxDescent),M=2,x=E.actualBoundingBoxLeft+M,C=E.actualBoundingBoxAscent+M;P+=M+M,L+=M+M,f=new OffscreenCanvas(P,L),b=f.getContext("2d"),b.font=y,b.fillStyle=g,b.fillText(n,x,C);var R=1/h;return{type:"bitmap",bitmap:f.transferToImageBitmap(),matrix:[R,0,0,R,-P*R/2,-L*R/2]}}r.exports=function(){return Z().apply(this,arguments)},r.exports.reset=function(){Z().reset()},r.exports.create=J,r.exports.shapeFromPath=Ie,r.exports.shapeFromText=Se})((function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}})(),G,!1);const z=G.exports;G.exports.create;const Ae={showScreen(e){["main-flow","result-screen","loading-screen"].forEach(d=>{const l=u(d);l&&l.classList.toggle("hidden",d!==e)});const r=u("footer-home"),s=u("footer-result"),o=u("app-footer");e==="main-flow"?(o&&o.classList.remove("hidden"),r&&r.classList.remove("hidden"),s&&s.classList.add("hidden")):e==="result-screen"?(o&&o.classList.remove("hidden"),r&&r.classList.add("hidden"),s&&s.classList.remove("hidden")):o&&o.classList.add("hidden")},updateStrings(e){const t=e.translations[e.currentLang],r={"location-title":t.locationTitle,"app-title":t.title,"app-subtitle":t.subtitle,"price-title":t.priceTitle,"filter-title":t.filterTitle,"find-btn":t.findBtn,"retry-btn":t.retry,"back-btn":t.backBtn,"loading-text":t.loading,"open-maps-btn":t.openMaps,"share-btn":t.shareBtn,"install-btn":t.installBtn,"reviews-title":t.reviews,"view-all-reviews":t.viewAllReviews,"photos-title":t.photosTitle,"view-all-photos":t.viewAllPhotos};Object.entries(r).forEach(([c,i])=>{const m=u(c);m&&(m.textContent=i)});const s=u("location-input");s&&(s.placeholder=t.searchPlaceholder);const o=u("location-display");o&&!e.Data.manualLocation&&(o.textContent=t.useCurrentLocation);const d=u("distance-title");d&&(d.innerHTML=`${t.distanceTitle} (<span id="distance-val">${e.Config.mins}</span> mins)`);const l=u("include-closed-btn");if(l){const c=e.Config.includeClosed;l.classList.toggle("active",c);const i=u("include-closed-label");i&&(i.textContent=c?t.includeClosed:t.excludeClosed)}document.querySelectorAll(".lang-selector span").forEach(c=>{c.classList.toggle("active",c.dataset.lang===e.currentLang)})},initFilters(e){const t=u("filter-list");if(!t)return;t.innerHTML="";const r=e.translations[e.currentLang].categories;Object.keys(r).forEach(s=>{const o=document.createElement("div");o.className=`filter-item ${e.Config.excluded.has(s)?"active":""}`,o.textContent=r[s],o.onclick=()=>{isActive?e.Config.excluded.add(s):e.Config.excluded.delete(s),e.saveSettings(),this.triggerHaptic(H.HAPTIC_FEEDBACK_DURATION.SHORT)},t.appendChild(o)}),document.querySelectorAll(".price-item").forEach(s=>{const o=s.dataset.price;s.classList.toggle("active",e.Config.prices.has(o)),s.onclick=()=>{isActive?e.Config.prices.add(o):e.Config.prices.delete(o),e.saveSettings(),this.triggerHaptic(H.HAPTIC_FEEDBACK_DURATION.SHORT)}})},async showResult(e,t,r={}){const{fromShare:s=!1}=r;this.showScreen("result-screen"),this.updateHistory(e,t),e.Data.currentPlace=t;const o=this.getElements();this.renderHeader(o,t,s),this.renderPhotos(o,t),this.renderReviews(o,t),this.renderDetails(o,t,e),this.renderMap(o.mapCont,t,e),s||this.triggerConfetti()},updateHistory(e,t){e.Data.lastPickedId=t.place_id,e.Data.history||(e.Data.history=[]),e.Data.history.includes(t.place_id)||e.Data.history.push(t.place_id)},getElements(){return{name:u("res-name"),rating:u("res-rating"),ratingCont:u("res-rating-container"),price:u("res-price"),priceCont:u("res-price-container"),cat:u("res-category"),catIcon:u("res-category-icon"),catCont:u("res-category-container"),hours:u("res-hours"),hoursCont:u("res-hours-container"),address:u("res-address"),mapCont:u("res-map-container"),phone:u("res-phone"),distance:u("res-distance"),distanceCont:u("res-distance-container"),mapsBtn:u("open-maps-btn"),photoCont:u("res-photo-container"),photoSection:u("res-photo-section"),photosViewAll:u("view-all-photos"),reviewsViewAll:u("view-all-reviews"),reviewsCont:u("res-reviews-container"),reviewsList:u("reviews-list")}},renderHeader(e,t,r){if(e.name&&(e.name.textContent=t.name),e.address&&(e.address.textContent=t.vicinity),e.reviewsViewAll&&(e.reviewsViewAll.href=t.googleMapsURI||"#"),e.photosViewAll&&(e.photosViewAll.href=t.googleMapsURI||"#"),!r){const s=u("result-screen");s&&s.scrollIntoView({behavior:"smooth",block:"start"})}},renderPhotos(e,t){e.photoSection&&(t.photos&&t.photos.length>0?(e.photoSection.classList.remove("hidden"),e.photoCont&&(e.photoCont.innerHTML="",t.photos.forEach(r=>{const s=document.createElement("img");s.src=r.getURI({maxHeight:400}),s.className="photo-item",s.alt=t.name,s.loading="lazy",s.style.opacity="0",s.style.transition="opacity 0.3s ease",s.onload=()=>{s.style.opacity="1"},s.onerror=function(){this.getAttribute("data-retried")?this.style.display="none":(this.setAttribute("data-retried","true"),setTimeout(()=>{const o=this.src.includes("?")?"&":"?";this.src=this.src+o+"retry="+Date.now()},1e3))},s.onclick=()=>window.open(s.src,"_blank"),e.photoCont.appendChild(s)}))):e.photoSection.classList.add("hidden"))},renderReviews(e,t){if(!(!e.reviewsCont||!e.reviewsList))if(t.reviews&&t.reviews.length>0){e.reviewsCont.classList.remove("hidden"),e.reviewsList.innerHTML="",e.reviewsList.scrollLeft=0;const r=t.reviews.filter(s=>s.text&&(s.text.text||s.text).length>0).sort((s,o)=>{const d=s.publishTime?new Date(s.publishTime).getTime():0;return(o.publishTime?new Date(o.publishTime).getTime():0)-d});r.length===0?e.reviewsCont.classList.add("hidden"):r.forEach(s=>{const o=document.createElement("div");o.className="review-item";const d="‚≠ê".repeat(Math.round(s.rating||0)),l=s.relativePublishTimeDescription||"";o.innerHTML=`
                        <div class="review-top">
                            <span class="review-author">${s.authorAttribution?.displayName||"Anonymous"}</span>
                            <span class="review-time">${l}</span>
                        </div>
                        <div class="review-stars">${d}</div>
                        <p class="review-text">${s.text?.text||s.text||""}</p>
                    `,e.reviewsList.appendChild(o)})}else e.reviewsCont.classList.add("hidden")},renderDetails(e,t,r){const s=r.translations[r.currentLang],o=typeof t.rating=="number"&&t.rating>0;e.rating&&(e.rating.textContent=o?t.rating:s.ratingNew.replace(/‚≠ê\s*/,""));const d=this.getPriceDisplay(t.priceLevel,s);e.price&&(e.price.textContent=d),e.priceCont&&(e.priceCont.style.display=d?"flex":"none");const l=this.getPlaceCategory(t,r);if(l){const i=l.match(new RegExp("^(\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F)\\s*(.*)$","u"));e.catIcon&&(e.catIcon.textContent=i?i[1]:"üç¥"),e.cat&&(e.cat.textContent=i?i[2]:l),e.catCont&&(e.catCont.style.display="flex")}else e.catCont&&(e.catCont.style.display="none");const c=this.getTodayHours(t,r);e.hours&&(e.hours.textContent=c),e.hoursCont&&(e.hoursCont.style.display=c?"flex":"none"),t.durationText?(e.distance&&(e.distance.textContent=t.durationText),e.distanceCont&&(e.distanceCont.style.display="flex")):e.distanceCont&&(e.distanceCont.style.display="none"),t.phone?e.phone&&(e.phone.textContent=`üìû ${t.phone}`,e.phone.href=`tel:${t.phone.replace(/\s+/g,"")}`,e.phone.style.display=""):e.phone&&(e.phone.style.display="none"),e.mapsBtn&&(e.mapsBtn.href=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(t.name)}&query_place_id=${t.place_id}`)},async renderMap(e,t,r){if(e){if(!t.location){e.style.display="none";return}e.classList.add("skeleton"),e.style.display="block";try{const[{Map:s},{AdvancedMarkerElement:o}]=await Promise.all([google.maps.importLibrary("maps"),google.maps.importLibrary("marker")]),d=new s(e,{center:t.location,zoom:16,mapId:"DEMO_MAP_ID",disableDefaultUI:!1,mapTypeControl:!1,streetViewControl:!1,gestureHandling:"greedy",colorScheme:"FOLLOW_SYSTEM"});if(new o({map:d,position:t.location,title:t.name}),r.Data.userPos){const l=document.createElement("div");l.style.width="16px",l.style.height="16px",l.style.backgroundColor="#4285F4",l.style.border="2px solid white",l.style.borderRadius="50%",l.style.boxShadow="0 0 4px rgba(0,0,0,0.3)",new o({map:d,position:r.Data.userPos,title:"Your Location",content:l});const c=new google.maps.LatLngBounds;c.extend(t.location),c.extend(r.Data.userPos),d.fitBounds(c,50)}google.maps.event.addListenerOnce(d,"idle",()=>e.classList.remove("skeleton"))}catch(s){console.error("Map Render Error:",s),e.style.display="none"}}},startSlotAnimation(e){const t=u("slot-name");if(!t)return;let r=0;const s=setInterval(()=>{const o=e.Data.candidates[Math.floor(Math.random()*e.Data.candidates.length)];t.textContent=o?.name||"...",++r>15&&(clearInterval(s),ue(e))},100)},getPlaceCategory(e,t){const r=t.translations[t.currentLang].categories,s=(e.name||"").toLowerCase(),o=e.types||[];for(const[d,l]of Object.entries(ae))if(l.some(c=>s.includes(c)||o.some(i=>i.toLowerCase().includes(c))))return r[d];return null},getPriceDisplay(e,t){if(e==null)return"";let r=e;A[r]&&(r=A[r]);const s=se[r];return s?s.label(t):""},getTodayHours(e,t){const r=e.openingHours?.weekdayDescriptions;if(!r||r.length!==7)return"";const s=new Date,d={zh:"zh-HK",en:"en-US",ja:"ja-JP"}[t.currentLang]||"zh-HK",l=s.toLocaleDateString(d,{weekday:"long"}),c=s.toLocaleDateString("en-US",{weekday:"long"});let i=r.find(m=>m.includes(l)||m.includes(c));if(i||(i=r[s.getDay()]),i){const m=i.split(/: |Ôºö/);return m[1]?m[1].trim():i}return""},triggerHaptic(e){navigator.vibrate&&navigator.vibrate(e||H.HAPTIC_FEEDBACK_DURATION.SHORT)},triggerConfetti(){(z.create?z.create():z)({particleCount:150,spread:70,origin:{y:.6},colors:["#ff6b81","#ffd32a","#2ecc71","#3498db"]})},async shareCurrentPlace(e){const t=e.Data.currentPlace;if(!t)return;const r=e.translations[e.currentLang],s=`${window.location.origin}${window.location.pathname}?resId=${t.place_id}${e.Data.userPos?`&lat=${e.Data.userPos.lat}&lng=${e.Data.userPos.lng}`:""}`,o=r.shareText.replace("${name}",t.name);if(navigator.share)try{await navigator.share({title:t.name,text:o,url:s})}catch(d){console.log("Share failed",d)}else try{await navigator.clipboard.writeText(`${o}
${s}`);const d=e.currentLang==="zh"?"Â∑≤Ë§áË£ΩÈÄ£ÁµêÂà∞Ââ™Ë≤ºÁ∞øÔºÅüìã":e.currentLang==="ja"?"„ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å´„Ç≥„Éî„Éº„Åó„Åæ„Åó„ÅüÔºÅüìã":"Link copied to clipboard! üìã";alert(d)}catch{alert(s)}}},$e="modulepreload",je=function(e){return"/"+e},ne={},We=function(t,r,s){let o=Promise.resolve();if(r&&r.length>0){let m=function(_){return Promise.all(_.map(p=>Promise.resolve(p).then(I=>({status:"fulfilled",value:I}),I=>({status:"rejected",reason:I}))))};var l=m;document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),i=c?.nonce||c?.getAttribute("nonce");o=m(r.map(_=>{if(_=je(_),_ in ne)return;ne[_]=!0;const p=_.endsWith(".css"),I=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${_}"]${I}`))return;const S=document.createElement("link");if(S.rel=p?"stylesheet":$e,p||(S.as="script"),S.crossOrigin="",S.href=_,i&&S.setAttribute("nonce",i),document.head.appendChild(S),p)return new Promise((O,V)=>{S.addEventListener("load",O),S.addEventListener("error",()=>V(new Error(`Unable to preload CSS for ${_}`)))})}))}function d(c){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=c,window.dispatchEvent(i),!i.defaultPrevented)throw c}return o.then(c=>{for(const i of c||[])i.status==="rejected"&&d(i.reason);return t().catch(d)})};function ze(e={}){const{immediate:t=!1,onNeedRefresh:r,onOfflineReady:s,onRegistered:o,onRegisteredSW:d,onRegisterError:l}=e;let c,i;const m=async(p=!0)=>{await i};async function _(){if("serviceWorker"in navigator){if(c=await We(async()=>{const{Workbox:p}=await import("./workbox-window.prod.es5-BIl4cyR9.js");return{Workbox:p}},[]).then(({Workbox:p})=>new p("/sw.js",{scope:"/",type:"classic"})).catch(p=>{l?.(p)}),!c)return;c.addEventListener("activated",p=>{(p.isUpdate||p.isExternal)&&window.location.reload()}),c.addEventListener("installed",p=>{p.isUpdate||s?.()}),c.register({immediate:t}).then(p=>{d?d("/sw.js",p):o?.(p)}).catch(p=>{l?.(p)})}}return i=_(),m}const qe={deferredPrompt:null,init(e,t){"serviceWorker"in navigator&&ze({immediate:!0,onNeedRefresh(){console.log("New content available, reloading..."),window.location.reload()},onOfflineReady(){console.log("App ready to work offline")}}),window.addEventListener("beforeinstallprompt",s=>{s.preventDefault(),this.deferredPrompt=s,u("install-container")&&!this.isIOS()&&u("install-container").classList.remove("hidden")}),window.addEventListener("appinstalled",()=>{this.deferredPrompt=null,u("install-container")&&u("install-container").classList.add("hidden")});const r=u("install-btn");r&&(r.addEventListener("click",()=>this.handleInstall()),this.isIOS()&&!this.isStandalone()&&(u("install-container").classList.remove("hidden"),r.innerHTML=`<span>${e[t].iosInstallText}</span>`,r.classList.add("ios-guide")))},isIOS(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream},isStandalone(){return window.navigator.standalone||window.matchMedia("(display-mode: standalone)").matches},async handleInstall(){if(this.isIOS()){alert(window.App.translations[window.App.currentLang].iosInstallAlert);return}if(!this.deferredPrompt)return;this.deferredPrompt.prompt();const{outcome:e}=await this.deferredPrompt.userChoice;this.deferredPrompt=null,u("install-container")&&u("install-container").classList.add("hidden")}},U={Config:{mins:parseInt(localStorage.getItem("currentMins")||H.DEFAULT_MINS.toString()),includeClosed:localStorage.getItem("includeClosed")==="true",get radius(){return this.mins*H.DEFAULT_SEARCH_RADIUS_MULTIPLIER},excluded:new Set(JSON.parse(localStorage.getItem("excludedTypes")||"[]")),prices:new Set(JSON.parse(localStorage.getItem("selectedPrices")||'["1","2","3","4"]')),lang:(function(){let t=new URLSearchParams(window.location.search).get("lang")||localStorage.getItem("preferredLang");if(t&&(t.startsWith("zh")&&(t="zh"),t.startsWith("ja")&&(t="ja"),["zh","en","ja"].includes(t)))return t;const r=navigator.language||navigator.userLanguage;return r.startsWith("ja")?"ja":r.startsWith("zh")?"zh":"en"})()},Data:{userPos:null,manualLocation:null,candidates:[],currentPlace:null,lastPickedId:null,history:[],params:new URLSearchParams(window.location.search)},UI:Ae,PWA:qe,translations:Ne,get currentLang(){return this.Config.lang},saveSettings(){localStorage.setItem("currentMins",this.Config.mins.toString()),localStorage.setItem("includeClosed",this.Config.includeClosed),localStorage.setItem("selectedPrices",JSON.stringify(Array.from(this.Config.prices))),localStorage.setItem("excludedTypes",JSON.stringify(Array.from(this.Config.excluded)))},setLanguage(e){if(this.currentLang===e)return;localStorage.setItem("preferredLang",e),this.saveSettings();let t=window.location.pathname+"?lang="+e;!u("result-screen").classList.contains("hidden")&&this.Data.lastPickedId&&(t+="&resId="+this.Data.lastPickedId,this.Data.userPos&&(t+=`&lat=${this.Data.userPos.lat}&lng=${this.Data.userPos.lng}`)),window.location.href=t},init(){Ve(),this.UI.updateStrings(this),this.UI.initFilters(this),this.setupEventListeners(),this.PWA.init(this.translations,this.currentLang),He(this),this.initLocationSearch()},async initLocationSearch(){const e=u("location-input"),t=u("location-bar"),r=u("location-display"),s=u("clear-location");if(!e||!t||!r||!s)return;const o=this.translations[this.currentLang];r.textContent=o.useCurrentLocation,t.onclick=l=>{l.target.closest(".clear-icon")||(t.classList.add("hidden"),e.classList.remove("hidden"),e.focus())};const d=()=>{setTimeout(()=>{e.classList.add("hidden"),t.classList.remove("hidden")},200)};e.onblur=d,s.onclick=l=>{l.stopPropagation(),this.Data.manualLocation=null,e.value="",r.textContent=o.useCurrentLocation,s.classList.add("hidden"),this.UI.triggerHaptic(30)};try{const{Autocomplete:l}=await google.maps.importLibrary("places"),c=new l(e,{fields:["geometry","name"],types:["geocode","establishment"]});c.addListener("place_changed",()=>{const i=c.getPlace();!i.geometry||!i.geometry.location||(this.Data.manualLocation={lat:i.geometry.location.lat(),lng:i.geometry.location.lng(),name:i.name},r.textContent="üìç "+i.name,s.classList.remove("hidden"),e.value=i.name,d(),this.UI.triggerHaptic(50))})}catch{}},setupEventListeners(){const e=u("find-btn");e&&(e.onclick=()=>oe(this));const t=u("retry-btn");t&&(t.onclick=()=>ue(this));const r=u("share-btn");r&&(r.onclick=()=>this.UI.shareCurrentPlace(this));const s=u("back-btn");s&&(s.onclick=()=>this.UI.showScreen("main-flow")),document.querySelectorAll(".lang-selector span").forEach(l=>{l.onclick=()=>this.setLanguage(l.dataset.lang)});const o=u("distance-slider");o&&(o.value=this.Config.mins,o.oninput=function(){const l=parseInt(this.value);U.Config.mins=l,u("distance-val").textContent=l,U.saveSettings(),U.UI.triggerHaptic(10)});const d=u("include-closed-btn");d&&(d.onclick=()=>{U.Config.includeClosed=!U.Config.includeClosed,U.saveSettings(),U.UI.updateStrings(U),U.UI.triggerHaptic(H.HAPTIC_FEEDBACK_DURATION.SHORT)})}};document.addEventListener("DOMContentLoaded",()=>{U.init()});
