(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))l(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&l(c)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}})();const xe={zh:{title:"é£Ÿä¹œå¥½",subtitle:"å””çŸ¥é£Ÿå’©ï¼Ÿç­‰æˆ‘å¹«ä½ æ€ï¼",distanceTitle:"æƒ³æµå¾’æ­¥å¹¾è€ï¼Ÿ",priceTitle:"åƒ¹éŒ¢é ç®—ï¼Ÿ",filterTitle:"ä»Šæ—¥å””æƒ³é£Ÿå’©ï¼Ÿ",findBtn:"å¹«æˆ‘æ€ï¼âœ¨",openMaps:"ðŸ—ºï¸ å–º Google Maps æ‰“é–‹",retry:"ðŸŽ² å””å¤šä¸­æ„ï¼ŸæŠ½éŽé–“ï¼",backBtn:"ðŸ  è¿”åŽ»ä¸»é ",loading:"æœå°‹ç·Šé™„è¿‘å¥½å˜¢é£Ÿ... ðŸ”",noResults:"é™„è¿‘æµå””åˆ°é–‹é–€å˜…é¤å»³ï¼Œè©¦ä¸‹æµé å•²ï¼Ÿ",noFilteredResults:"æµå””åˆ°ç¬¦åˆç¯©é¸æ¢ä»¶å˜…é¤å»³ï¼Œè©¦ä¸‹èª¿æ•´ä¸‹ã€Œä»Šæ—¥å””æƒ³é£Ÿå’©ã€ï¼ŸðŸ”",geoError:"æ‹Žå””åˆ°ä½ å€‹ä½ç½®ï¼Œè«‹æª¢æŸ¥ä¸‹æ¬Šé™ã€‚ðŸ“",noGeo:"ä½ å€‹ç€è¦½å™¨å””æ”¯æ´å–ç”¨åœ°ç†ä½ç½®ã€‚",locationTitle:"æƒ³æµé‚Šé ­ï¼Ÿ",searchPlaceholder:"ðŸ” æœå°‹åœ°é»ž",useCurrentLocation:"ðŸ“ ä½¿ç”¨ç•¶å‰ä½ç½®",installBtn:"å®‰è£ App ðŸ“²",iosInstallText:"é»žæ“ŠæŸ¥çœ‹ã€Œå®‰è£ Appã€æ•™å­¸ ðŸ“²",iosInstallAlert:`æƒ³å¥½ä¼¼ App å’ç”¨ã€Œé£Ÿä¹œå¥½ã€ï¼Ÿ

1. æ’³ç€è¦½å™¨åº•éƒ¨åˆ†äº«é¸å–® (æ­£æ–¹å½¢å‘ä¸Šç®­é ­)
2. å‘ä¸ŠæŽƒä¸¦é»žé¸ã€ŒåŠ å…¥ä¸»ç•«é¢ã€(Add to Home Screen)

æžæŽ‚ï¼âœ¨`,categories:{chinese:"ðŸš ä¸­é¤",japanese:"ðŸ£ æ—¥æœ¬èœ",korean:"ðŸ‡°ðŸ‡· éŸ“åœ‹èœ",western:"ðŸ• è¥¿é¤",se_asian:"ðŸ² æ±å—äºž",noodles:"ðŸœ ç²‰éºµ",spicy:"ðŸŒ¶ï¸ è¾£å˜¢",hotpot_bbq:"ðŸ”¥ ç«é‹/ç‡’çƒ¤",dim_sum:"ðŸ¥Ÿ é»žå¿ƒ/é£²èŒ¶",dessert:"ðŸ§ ç”œå“/ç³–æ°´",fast_food:"ðŸ” å¿«é¤/å°é£Ÿ",cafe_light:"â˜• å’–å•¡/è¼•é£Ÿ"},unknownName:"åç¨±ä¸è©³",noAddress:"åœ°å€ä¸è©³",ratingNew:"â­ æ–°é–‹å¼µï¼",priceFree:"å…è²»",walkMins:"æ­¥è¡Œç´„ ${mins} åˆ†é˜",shareBtn:"ðŸ“¤ åˆ†äº«é¤å»³",shareText:"æˆ‘å–ºã€Œé£Ÿä¹œå¥½ã€æŠ½ä¸­å’—å‘¢é–“ï¼š${name}ï¼ä¸€é½ŠåŽ»è©¦ä¸‹ï¼ŸðŸ¥—",includeClosed:"åŒ…å«å·²é—œé–€é¤å»³ ðŸŒ™",excludeClosed:"åªé¸ç‡Ÿæ¥­ä¸­é¤å»³ â˜€ï¸"},en:{title:"What to Eat",subtitle:"Don't know? Let me pick!",distanceTitle:"Walking Distance",priceTitle:"Price Range",filterTitle:"What do you NOT want to eat?",findBtn:"Pick for me! âœ¨",openMaps:"ðŸ—ºï¸ Open in Google Maps",retry:"ðŸŽ² Not this one? Re-roll!",backBtn:"ðŸ  Back to Home",loading:"Searching for delicious food... ðŸ”",noResults:"No open restaurants found nearby. Try moving a bit?",noFilteredResults:"No restaurants match your filters. Try adjusting them! ðŸ”",geoError:"Unable to find location. Check permissions.",noGeo:"Geolocation not supported by this browser.",locationTitle:"Where to eat?",searchPlaceholder:"ðŸ” Search Location",useCurrentLocation:"ðŸ“ Use Current Location",installBtn:"Install App ðŸ“²",iosInstallText:"How to Install App ðŸ“²",iosInstallAlert:`Want to use 'What to Eat' like an App?

1. Tap the Share button in Safari (square with up arrow)
2. Scroll down and tap 'Add to Home Screen'

All set! âœ¨`,categories:{chinese:"ðŸš Chinese",japanese:"ðŸ£ Japanese",korean:"ðŸ‡°ðŸ‡· Korean",western:"ðŸ• Western",se_asian:"ðŸ² SE Asian",noodles:"ðŸœ Noodles",spicy:"ðŸŒ¶ï¸ Spicy",hotpot_bbq:"ðŸ”¥ Hotpot/BBQ",dim_sum:"ðŸ¥Ÿ Dim Sum",dessert:"ðŸ§ Dessert",fast_food:"ðŸ” Fast Food",cafe_light:"â˜• Cafe/Light"},unknownName:"Unknown",noAddress:"Address Unknown",ratingNew:"â­ New!",priceFree:"Free",walkMins:"ðŸš¶ ${mins} min walk",shareBtn:"ðŸ“¤ Share",shareText:"I picked this on What to Eat: ${name}! Want to try? ðŸ¥—",includeClosed:"Includes Closed Restaurants ðŸŒ™",excludeClosed:"Open Restaurants Only â˜€ï¸"},ja:{title:"ãƒ¡ã‚·æ±º",subtitle:"è¿·ã£ãŸã‚‰ã€ç§ã«é¸ã°ã›ã¦ï¼",distanceTitle:"å¾’æ­©ä½•åˆ†ï¼Ÿ",priceTitle:"äºˆç®—ã¯ï¼Ÿ",filterTitle:"ä»Šã¯é£Ÿã¹ãŸããªã„ã‚‚ã®ã¯ï¼Ÿ",findBtn:"é¸ã‚“ã§ï¼ âœ¨",openMaps:"ðŸ—ºï¸ Googleãƒžãƒƒãƒ—ã§é–‹ã",retry:"ðŸŽ² ä»–ã®ãŒã„ã„ï¼",backBtn:"ðŸ  ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹",loading:"è¿‘ãã®ç¾Žå‘³ã—ã„åº—ã‚’æŽ¢ã—ã¦ã„ã¾ã™... ðŸ”",noResults:"è¿‘ãã«å–¶æ¥­ä¸­ã®åº—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚",noFilteredResults:"æ¡ä»¶ã«åˆã†åº—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’èª¿æ•´ã—ã¦ã¿ã¦ãã ã•ã„ã€‚ðŸ”",geoError:"ä½ç½®æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã€‚è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚",noGeo:"ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ä½ç½®æƒ…å ±ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚",locationTitle:"ã©ã®è¾ºã§é£Ÿã¹ã‚‹ï¼Ÿ",searchPlaceholder:"ðŸ” å ´æ‰€ã‚’æ¤œç´¢",useCurrentLocation:"ðŸ“ ç¾åœ¨åœ°ã‚’ä½¿ç”¨",installBtn:"ã‚¢ãƒ—ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ðŸ“²",iosInstallText:"ã‚¢ãƒ—ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³• ðŸ“²",iosInstallAlert:`ã€Œä½•é£Ÿã¹ã‚‹ï¼Ÿã€ã‚’ã‚¢ãƒ—ãƒªã®ã‚ˆã†ã«ä½¿ã†æ–¹æ³•ï¼š

1. Safari ã®å…±æœ‰ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆå››è§’ã«ä¸ŠçŸ¢å°ï¼‰ã‚’ã‚¿ãƒƒãƒ—
2. ä¸‹ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ã‚’ã‚¿ãƒƒãƒ—

å®Œäº†ã§ã™ï¼âœ¨`,categories:{chinese:"ðŸš ä¸­è¯æ–™ç†",japanese:"ðŸ£ æ—¥æœ¬æ–™ç†",korean:"ðŸ‡°ðŸ‡· éŸ“å›½æ–™ç†",western:"ðŸ• æ´‹é£Ÿ",se_asian:"ðŸ² æ±å—äºž",noodles:"ðŸœ éººé¡ž",spicy:"ðŸŒ¶ï¸ è¾›ã„æ–™ç†",hotpot_bbq:"ðŸ”¥ ç«é‹/ç„¼è‚‰",dim_sum:"ðŸ¥Ÿ ç‚¹å¿ƒ",dessert:"ðŸ§ ãƒ‡ã‚¶ãƒ¼ãƒˆ",fast_food:"ðŸ” ãƒ•ã‚¡ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰",cafe_light:"â˜• ã‚«ãƒ•ã‚§/è»½é£Ÿ"},unknownName:"ä¸æ˜Ž",noAddress:"ä½æ‰€ä¸æ˜Ž",ratingNew:"â­ æ–°è¦ã‚ªãƒ¼ãƒ—ãƒ³ï¼",priceFree:"ç„¡æ–™",walkMins:"ðŸš¶ å¾’æ­© ${mins} åˆ†",shareBtn:"ðŸ“¤ ã‚·ã‚§ã‚¢",shareText:"ã€Œãƒ¡ã‚·æ±ºã€ã§ã“ã‚Œã‚’é¸ã‚“ã ã‚ˆï¼š${name}ï¼ä¸€ç·’ã«ã©ã†ï¼ŸðŸ¥—",includeClosed:"å–¶æ¥­æ™‚é–“å¤–ã‚‚å«ã‚€ ðŸŒ™",excludeClosed:"å–¶æ¥­ä¸­ã®ã¿ â˜€ï¸"}},h=e=>document.getElementById(e);function Te(e={}){return new Promise((n,r)=>{if(!navigator.geolocation){r(new Error("GEOLOCATION_NOT_SUPPORTED"));return}navigator.geolocation.getCurrentPosition(n,r,{enableHighAccuracy:!0,timeout:5e3,maximumAge:0,...e})})}const ee={chinese:["chinese_restaurant","chinese","cantonese","shanghainese","sichuan","dim sum","congee","ä¸­èœ","ä¸­å¼","ç²µèœ","é»žå¿ƒ","ç²¥"],japanese:["japanese_restaurant","sushi_restaurant","ramen_restaurant","japanese","sushi","ramen","izakaya","udon","soba","yakitori","tonkatsu","æ—¥æœ¬","å£½å¸","æ‹‰éºµ","å±…é…’å±‹","çƒå†¬","ç‡’é³¥"],korean:["korean_restaurant","korean","kimchi","bibimbap","bbq","éŸ“åœ‹","éŸ“å¼","æ³¡èœ","é£¯å·","éŸ“ç‡’"],western:["italian_restaurant","french_restaurant","american_restaurant","hamburger_restaurant","pizza_restaurant","steak_house","steak","italian","french","burger","pasta","pizza","western","mexican","spanish","è¥¿é¤","æ„å¼","æ³•å¼","æ¼¢å ¡","è–„é¤…","ç‰›æ‰’"],se_asian:["thai_restaurant","vietnamese_restaurant","thai","vietnamese","malaysian","singaporean","indonesian","æ³°åœ‹","è¶Šå—","æ˜Ÿé¦¬","å°å°¼","æ³°å¼","è¶Šå¼"],noodles:["ramen_restaurant","noodle","ramen","udon","pho","ç±³ç·š","æ‹‰éºµ","éºµ","ç²‰","æ²³"],spicy:["spicy","sichuan","mala","chili","å·èœ","éº»è¾£","è¾£","æ°´ç…®","é…¸è¾£"],hotpot_bbq:["barbecue_restaurant","steak_house","hot pot","hotpot","bbq","barbecue","grill","yakiniku","ç«é‹","é›žç…²","ç‡’è‚‰","éŸ“ç‡’","ç‡’çƒ¤","ä¸²ç‡’"],dim_sum:["chinese_restaurant","dim sum","yum cha","dumpling","é»žå¿ƒ","é£²èŒ¶","é¤ƒå­","ç›…é£¯"],dessert:["bakery","ice_cream_shop","dessert","sugar","sweet","bakery","cake","ice cream","ç³–æ°´","ç”œ","é›ªç³•","å†°","è›‹ç³•","é¤…"],fast_food:["fast_food_restaurant","hamburger_restaurant","sandwich_shop","fast food","mcdonald","kfc","burger","sandwich","å¿«é¤","å°é£Ÿ","æ¼¢å ¡","ä¸‰æ–‡æ²»"],cafe_light:["cafe","coffee_shop","bakery","cafe","coffee","sandwich","salad","breakfast","brunch","è¼•é£Ÿ","å’–å•¡","æ²™å¾‹","æ—©é¤","æ—©åˆé¤","æ–‡é’"]},z=["displayName","location","rating","userRatingCount","formattedAddress","id","types","regularOpeningHours","priceLevel","nationalPhoneNumber","businessStatus"],te={PRICE_LEVEL_FREE:{val:"0",label:e=>e.priceFree},PRICE_LEVEL_INEXPENSIVE:{val:"1",label:()=>"$"},PRICE_LEVEL_MODERATE:{val:"2",label:()=>"$$"},PRICE_LEVEL_EXPENSIVE:{val:"3",label:()=>"$$$"},PRICE_LEVEL_VERY_EXPENSIVE:{val:"4",label:()=>"$$$$"}},H={0:"PRICE_LEVEL_FREE",1:"PRICE_LEVEL_INEXPENSIVE",2:"PRICE_LEVEL_MODERATE",3:"PRICE_LEVEL_EXPENSIVE",4:"PRICE_LEVEL_VERY_EXPENSIVE"};function q(e,n){const r=n;return{name:typeof e.displayName=="string"?e.displayName:e.displayName?.text||r.unknownName,rating:e.rating,userRatingCount:e.userRatingCount||0,vicinity:e.formattedAddress||e.vicinity||r.noAddress,place_id:e.id||e.place_id,types:e.types||[],priceLevel:e.priceLevel,phone:e.nationalPhoneNumber,businessStatus:e.businessStatus,location:e.location,openingHours:e.regularOpeningHours,isOpen:null,durationText:null,durationValue:null}}async function ne(e){e.UI.triggerHaptic(50),e.UI.showScreen("loading-screen"),e.Data.history=[];const n=e.translations[e.currentLang];try{let r;e.Data.manualLocation?r={coords:{latitude:e.Data.manualLocation.lat,longitude:e.Data.manualLocation.lng}}:r=await Te();const{latitude:l,longitude:s}=r.coords;e.Data.userPos={lat:l,lng:s};const{Place:o}=await google.maps.importLibrary("places"),c=await ae(o,e.Data.userPos,e.Config.radius);if(!c||c.length===0){alert(n.noResults),e.UI.showScreen("main-flow");return}const d=await re(c,e.Data.userPos,e);if(d.length===0){alert(n.noFilteredResults),e.UI.showScreen("main-flow");return}e.Data.candidates=d,e.UI.startSlotAnimation(e)}catch(r){console.error("Search Error:",r),Re(r,n,e)}}async function ae(e,n,r){const l={locationRestriction:{center:n,radius:r},includedPrimaryTypes:["restaurant"],fields:z,maxResultCount:20,rankPreference:"POPULARITY"},{places:s}=await e.searchNearby(l);return s}async function re(e,n,r){const l=r.translations[r.currentLang];let o=(await Promise.all(e.map(async i=>{const m=q(i,l);try{m.openingHours?.periods&&(m.isOpen=De(m.openingHours.periods)),m.isOpen===null&&(m.isOpen=await i.isOpen()),m.isOpen===null&&(m.isOpen=m.openingHours?.openNow)}catch{m.isOpen=null}return m}))).filter(i=>i.businessStatus!=="OPERATIONAL"&&i.businessStatus?!1:r.Config.includeClosed?!0:i.isOpen!==!1);const c=await se(n,o);let d=c.filter(i=>i.durationValue===null||i.durationValue/60<=r.Config.mins);return d.length===0&&(d=c.sort((i,m)=>(i.durationValue||9999)-(m.durationValue||9999)).slice(0,3)),d.filter(i=>{const m=(i.name||"").toLowerCase(),P=i.types||[];if(Array.from(r.Config.excluded).some(k=>(ee[k]||[]).some(U=>m.includes(U)||P.some($=>$.toLowerCase().includes(U)))))return!1;if(i.priceLevel!==void 0&&i.priceLevel!==null){let k=i.priceLevel;H[k]&&(k=H[k]);const x=te[k];if(x&&r.Config.prices.size>0&&!r.Config.prices.has(x.val))return!1}return!0})}function De(e){if(!e||!Array.isArray(e)||e.length===0)return null;if(e.length===1&&!e[0].close)return!0;const n=new Date,r=n.getDay()*1440+n.getHours()*60+n.getMinutes(),l=10080;for(const s of e){if(!s.open||!s.close)continue;const o=Number(s.open.day)*1440+Number(s.open.hour)*60+Number(s.open.minute);let c=Number(s.close.day)*1440+Number(s.close.hour)*60+Number(s.close.minute);if(c<=o&&(c+=l),r>=o&&r<c||r+l>=o&&r+l<c)return!0}return!1}function Re(e,n,r){e.message==="GEOLOCATION_NOT_SUPPORTED"?alert(n.noGeo):e.code===1?alert(n.geoError):alert("Error: "+e.message),r.UI.showScreen("main-flow")}async function se(e,n){if(n.length===0)return[];const r=new google.maps.DistanceMatrixService;return new Promise(l=>{r.getDistanceMatrix({origins:[e],destinations:n.map(s=>s.location),travelMode:google.maps.TravelMode.WALKING,unitSystem:google.maps.UnitSystem.METRIC},(s,o)=>{if(o!=="OK"){l(n.map(d=>({...d,durationText:null,durationValue:null})));return}const c=s.rows[0].elements;l(n.map((d,i)=>({...d,durationText:c[i].status==="OK"?c[i].duration.text:null,durationValue:c[i].status==="OK"?c[i].duration.value:null})))})})}async function oe(e){if(e.UI.triggerHaptic([50,30,50]),e.Data.candidates.length===0)return ne(e);let n=e.Data.candidates;if(n.length>1){const s=new Set(e.Data.history||[]),o=n.filter(c=>!s.has(c.place_id));if(o.length>0)n=o;else if(e.Data.lastPickedId){const c=n.filter(d=>d.place_id!==e.Data.lastPickedId);c.length>0&&(n=c)}}let r=n[Math.floor(Math.random()*n.length)];const l=r.openingHours?.weekdayDescriptions?.length>0;if((!r.vicinity||!l)&&r.place_id)try{const{Place:s}=await google.maps.importLibrary("places"),o=new s({id:r.place_id});await o.fetchFields({fields:z}),r=q(o,e.translations[e.currentLang]);const c=e.Data.candidates.findIndex(d=>d.place_id===r.place_id);c!==-1&&(e.Data.candidates[c]=r)}catch(s){console.error("Fetch Details Error:",s)}e.UI.showResult(e,r)}async function Oe(e){const n=e.Data.params.get("resId");if(n){window.history.replaceState({},document.title,window.location.pathname),e.UI.showScreen("loading-screen");try{const{Place:r}=await google.maps.importLibrary("places"),l=new r({id:n});await l.fetchFields({fields:z});const s=e.Data.params.get("lat"),o=e.Data.params.get("lng");s&&o&&(e.Data.userPos={lat:parseFloat(s),lng:parseFloat(o)});const c=e.translations[e.currentLang],d=q(l,c);if(e.Data.userPos&&d.location){const[i]=await se(e.Data.userPos,[d]);d.durationText=i.durationText,d.durationValue=i.durationValue}if(e.Data.userPos){const i=await ae(r,e.Data.userPos,e.Config.radius);i&&i.length>0&&(e.Data.candidates=await re(i,e.Data.userPos,e))}e.UI.showResult(e,d,{fromShare:!0})}catch(r){console.error("Session restoration failed:",r),e.UI.showScreen("main-flow")}}}var G={};(function e(n,r,l,s){var o=!!(n.Worker&&n.Blob&&n.Promise&&n.OffscreenCanvas&&n.OffscreenCanvasRenderingContext2D&&n.HTMLCanvasElement&&n.HTMLCanvasElement.prototype.transferControlToOffscreen&&n.URL&&n.URL.createObjectURL),c=typeof Path2D=="function"&&typeof DOMMatrix=="function",d=(function(){if(!n.OffscreenCanvas)return!1;try{var a=new OffscreenCanvas(1,1),t=a.getContext("2d");t.fillRect(0,0,1,1);var u=a.transferToImageBitmap();t.createPattern(u,"no-repeat")}catch{return!1}return!0})();function i(){}function m(a){var t=r.exports.Promise,u=t!==void 0?t:n.Promise;return typeof u=="function"?new u(a):(a(i,i),null)}var P=(function(a,t){return{transform:function(u){if(a)return u;if(t.has(u))return t.get(u);var g=new OffscreenCanvas(u.width,u.height),y=g.getContext("2d");return y.drawImage(u,0,0),t.set(u,g),g},clear:function(){t.clear()}}})(d,new Map),C=(function(){var a=Math.floor(16.666666666666668),t,u,g={},y=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(t=function(v){var p=Math.random();return g[p]=requestAnimationFrame(function f(w){y===w||y+a-1<w?(y=w,delete g[p],v()):g[p]=requestAnimationFrame(f)}),p},u=function(v){g[v]&&cancelAnimationFrame(g[v])}):(t=function(v){return setTimeout(v,a)},u=function(v){return clearTimeout(v)}),{frame:t,cancel:u}})(),k=(function(){var a,t,u={};function g(y){function v(p,f){y.postMessage({options:p||{},callback:f})}y.init=function(f){var w=f.transferControlToOffscreen();y.postMessage({canvas:w},[w])},y.fire=function(f,w,L){if(t)return v(f,null),t;var M=Math.random().toString(36).slice(2);return t=m(function(E){function I(_){_.data.callback===M&&(delete u[M],y.removeEventListener("message",I),t=null,P.clear(),L(),E())}y.addEventListener("message",I),v(f,M),u[M]=I.bind(null,{data:{callback:M}})}),t},y.reset=function(){y.postMessage({reset:!0});for(var f in u)u[f](),delete u[f]}}return function(){if(a)return a;if(!l&&o){var y=["var CONFETTI, SIZE = {}, module = {};","("+e.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{a=new Worker(URL.createObjectURL(new Blob([y])))}catch(v){return typeof console<"u"&&typeof console.warn=="function"&&console.warn("ðŸŽŠ Could not load worker",v),null}g(a)}return a}})(),x={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function U(a,t){return t?t(a):a}function $(a){return a!=null}function S(a,t,u){return U(a&&$(a[t])?a[t]:x[t],u)}function ie(a){return a<0?0:Math.floor(a)}function le(a,t){return Math.floor(Math.random()*(t-a))+a}function V(a){return parseInt(a,16)}function ce(a){return a.map(de)}function de(a){var t=String(a).replace(/[^0-9a-f]/gi,"");return t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),{r:V(t.substring(0,2)),g:V(t.substring(2,4)),b:V(t.substring(4,6))}}function ue(a){var t=S(a,"origin",Object);return t.x=S(t,"x",Number),t.y=S(t,"y",Number),t}function he(a){a.width=document.documentElement.clientWidth,a.height=document.documentElement.clientHeight}function fe(a){var t=a.getBoundingClientRect();a.width=t.width,a.height=t.height}function ge(a){var t=document.createElement("canvas");return t.style.position="fixed",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.zIndex=a,t}function me(a,t,u,g,y,v,p,f,w){a.save(),a.translate(t,u),a.rotate(v),a.scale(g,y),a.arc(0,0,1,p,f,w),a.restore()}function ye(a){var t=a.angle*(Math.PI/180),u=a.spread*(Math.PI/180);return{x:a.x,y:a.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:a.startVelocity*.5+Math.random()*a.startVelocity,angle2D:-t+(.5*u-Math.random()*u),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:a.color,shape:a.shape,tick:0,totalTicks:a.ticks,decay:a.decay,drift:a.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:a.gravity*3,ovalScalar:.6,scalar:a.scalar,flat:a.flat}}function ve(a,t){t.x+=Math.cos(t.angle2D)*t.velocity+t.drift,t.y+=Math.sin(t.angle2D)*t.velocity+t.gravity,t.velocity*=t.decay,t.flat?(t.wobble=0,t.wobbleX=t.x+10*t.scalar,t.wobbleY=t.y+10*t.scalar,t.tiltSin=0,t.tiltCos=0,t.random=1):(t.wobble+=t.wobbleSpeed,t.wobbleX=t.x+10*t.scalar*Math.cos(t.wobble),t.wobbleY=t.y+10*t.scalar*Math.sin(t.wobble),t.tiltAngle+=.1,t.tiltSin=Math.sin(t.tiltAngle),t.tiltCos=Math.cos(t.tiltAngle),t.random=Math.random()+2);var u=t.tick++/t.totalTicks,g=t.x+t.random*t.tiltCos,y=t.y+t.random*t.tiltSin,v=t.wobbleX+t.random*t.tiltCos,p=t.wobbleY+t.random*t.tiltSin;if(a.fillStyle="rgba("+t.color.r+", "+t.color.g+", "+t.color.b+", "+(1-u)+")",a.beginPath(),c&&t.shape.type==="path"&&typeof t.shape.path=="string"&&Array.isArray(t.shape.matrix))a.fill(we(t.shape.path,t.shape.matrix,t.x,t.y,Math.abs(v-g)*.1,Math.abs(p-y)*.1,Math.PI/10*t.wobble));else if(t.shape.type==="bitmap"){var f=Math.PI/10*t.wobble,w=Math.abs(v-g)*.1,L=Math.abs(p-y)*.1,M=t.shape.bitmap.width*t.scalar,E=t.shape.bitmap.height*t.scalar,I=new DOMMatrix([Math.cos(f)*w,Math.sin(f)*w,-Math.sin(f)*L,Math.cos(f)*L,t.x,t.y]);I.multiplySelf(new DOMMatrix(t.shape.matrix));var _=a.createPattern(P.transform(t.shape.bitmap),"no-repeat");_.setTransform(I),a.globalAlpha=1-u,a.fillStyle=_,a.fillRect(t.x-M/2,t.y-E/2,M,E),a.globalAlpha=1}else if(t.shape==="circle")a.ellipse?a.ellipse(t.x,t.y,Math.abs(v-g)*t.ovalScalar,Math.abs(p-y)*t.ovalScalar,Math.PI/10*t.wobble,0,2*Math.PI):me(a,t.x,t.y,Math.abs(v-g)*t.ovalScalar,Math.abs(p-y)*t.ovalScalar,Math.PI/10*t.wobble,0,2*Math.PI);else if(t.shape==="star")for(var b=Math.PI/2*3,T=4*t.scalar,D=8*t.scalar,R=t.x,F=t.y,B=5,O=Math.PI/B;B--;)R=t.x+Math.cos(b)*D,F=t.y+Math.sin(b)*D,a.lineTo(R,F),b+=O,R=t.x+Math.cos(b)*T,F=t.y+Math.sin(b)*T,a.lineTo(R,F),b+=O;else a.moveTo(Math.floor(t.x),Math.floor(t.y)),a.lineTo(Math.floor(t.wobbleX),Math.floor(y)),a.lineTo(Math.floor(v),Math.floor(p)),a.lineTo(Math.floor(g),Math.floor(t.wobbleY));return a.closePath(),a.fill(),t.tick<t.totalTicks}function pe(a,t,u,g,y){var v=t.slice(),p=a.getContext("2d"),f,w,L=m(function(M){function E(){f=w=null,p.clearRect(0,0,g.width,g.height),P.clear(),y(),M()}function I(){l&&!(g.width===s.width&&g.height===s.height)&&(g.width=a.width=s.width,g.height=a.height=s.height),!g.width&&!g.height&&(u(a),g.width=a.width,g.height=a.height),p.clearRect(0,0,g.width,g.height),v=v.filter(function(_){return ve(p,_)}),v.length?f=C.frame(I):E()}f=C.frame(I),w=E});return{addFettis:function(M){return v=v.concat(M),L},canvas:a,promise:L,reset:function(){f&&C.cancel(f),w&&w()}}}function K(a,t){var u=!a,g=!!S(t||{},"resize"),y=!1,v=S(t,"disableForReducedMotion",Boolean),p=o&&!!S(t||{},"useWorker"),f=p?k():null,w=u?he:fe,L=a&&f?!!a.__confetti_initialized:!1,M=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,E;function I(b,T,D){for(var R=S(b,"particleCount",ie),F=S(b,"angle",Number),B=S(b,"spread",Number),O=S(b,"startVelocity",Number),Le=S(b,"decay",Number),Ee=S(b,"gravity",Number),Pe=S(b,"drift",Number),Z=S(b,"colors",ce),Me=S(b,"ticks",Number),X=S(b,"shapes"),Ie=S(b,"scalar"),Se=!!S(b,"flat"),Y=ue(b),Q=R,j=[],_e=a.width*Y.x,ke=a.height*Y.y;Q--;)j.push(ye({x:_e,y:ke,angle:F,spread:B,startVelocity:O,color:Z[Q%Z.length],shape:X[le(0,X.length)],ticks:Me,decay:Le,gravity:Ee,drift:Pe,scalar:Ie,flat:Se}));return E?E.addFettis(j):(E=pe(a,j,w,T,D),E.promise)}function _(b){var T=v||S(b,"disableForReducedMotion",Boolean),D=S(b,"zIndex",Number);if(T&&M)return m(function(O){O()});u&&E?a=E.canvas:u&&!a&&(a=ge(D),document.body.appendChild(a)),g&&!L&&w(a);var R={width:a.width,height:a.height};f&&!L&&f.init(a),L=!0,f&&(a.__confetti_initialized=!0);function F(){if(f){var O={getBoundingClientRect:function(){if(!u)return a.getBoundingClientRect()}};w(O),f.postMessage({resize:{width:O.width,height:O.height}});return}R.width=R.height=null}function B(){E=null,g&&(y=!1,n.removeEventListener("resize",F)),u&&a&&(document.body.contains(a)&&document.body.removeChild(a),a=null,L=!1)}return g&&!y&&(y=!0,n.addEventListener("resize",F,!1)),f?f.fire(b,R,B):I(b,R,B)}return _.reset=function(){f&&f.reset(),E&&E.reset()},_}var W;function J(){return W||(W=K(null,{useWorker:!0,resize:!0})),W}function we(a,t,u,g,y,v,p){var f=new Path2D(a),w=new Path2D;w.addPath(f,new DOMMatrix(t));var L=new Path2D;return L.addPath(w,new DOMMatrix([Math.cos(p)*y,Math.sin(p)*y,-Math.sin(p)*v,Math.cos(p)*v,u,g])),L}function be(a){if(!c)throw new Error("path confetti are not supported in this browser");var t,u;typeof a=="string"?t=a:(t=a.path,u=a.matrix);var g=new Path2D(t),y=document.createElement("canvas"),v=y.getContext("2d");if(!u){for(var p=1e3,f=p,w=p,L=0,M=0,E,I,_=0;_<p;_+=2)for(var b=0;b<p;b+=2)v.isPointInPath(g,_,b,"nonzero")&&(f=Math.min(f,_),w=Math.min(w,b),L=Math.max(L,_),M=Math.max(M,b));E=L-f,I=M-w;var T=10,D=Math.min(T/E,T/I);u=[D,0,0,D,-Math.round(E/2+f)*D,-Math.round(I/2+w)*D]}return{type:"path",path:t,matrix:u}}function Ce(a){var t,u=1,g="#000000",y='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof a=="string"?t=a:(t=a.text,u="scalar"in a?a.scalar:u,y="fontFamily"in a?a.fontFamily:y,g="color"in a?a.color:g);var v=10*u,p=""+v+"px "+y,f=new OffscreenCanvas(v,v),w=f.getContext("2d");w.font=p;var L=w.measureText(t),M=Math.ceil(L.actualBoundingBoxRight+L.actualBoundingBoxLeft),E=Math.ceil(L.actualBoundingBoxAscent+L.actualBoundingBoxDescent),I=2,_=L.actualBoundingBoxLeft+I,b=L.actualBoundingBoxAscent+I;M+=I+I,E+=I+I,f=new OffscreenCanvas(M,E),w=f.getContext("2d"),w.font=p,w.fillStyle=g,w.fillText(t,_,b);var T=1/u;return{type:"bitmap",bitmap:f.transferToImageBitmap(),matrix:[T,0,0,T,-M*T/2,-E*T/2]}}r.exports=function(){return J().apply(this,arguments)},r.exports.reset=function(){J().reset()},r.exports.create=K,r.exports.shapeFromPath=be,r.exports.shapeFromText=Ce})((function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}})(),G,!1);const Ne=G.exports;G.exports.create;const Fe={showScreen(e){["main-flow","result-screen","loading-screen"].forEach(o=>{const c=h(o);c&&c.classList.toggle("hidden",o!==e)});const r=h("footer-home"),l=h("footer-result"),s=h("app-footer");e==="main-flow"?(s&&s.classList.remove("hidden"),r&&r.classList.remove("hidden"),l&&l.classList.add("hidden")):e==="result-screen"?(s&&s.classList.remove("hidden"),r&&r.classList.add("hidden"),l&&l.classList.remove("hidden")):s&&s.classList.add("hidden")},updateStrings(e){const n=e.translations[e.currentLang],r={"location-title":n.locationTitle,"app-title":n.title,"app-subtitle":n.subtitle,"price-title":n.priceTitle,"filter-title":n.filterTitle,"find-btn":n.findBtn,"retry-btn":n.retry,"back-btn":n.backBtn,"loading-text":n.loading,"open-maps-btn":n.openMaps,"share-btn":n.shareBtn,"install-btn":n.installBtn};Object.entries(r).forEach(([d,i])=>{const m=h(d);m&&(m.textContent=i)});const l=h("location-input");l&&(l.placeholder=n.searchPlaceholder);const s=h("location-display");s&&!e.Data.manualLocation&&(s.textContent=n.useCurrentLocation);const o=h("distance-title");o&&(o.innerHTML=`${n.distanceTitle} (<span id="distance-val">${e.Config.mins}</span> mins)`);const c=h("include-closed-btn");if(c){const d=e.Config.includeClosed;c.classList.toggle("active",d);const i=h("include-closed-label");i&&(i.textContent=d?n.includeClosed:n.excludeClosed)}document.querySelectorAll(".lang-selector span").forEach(d=>{d.classList.toggle("active",d.dataset.lang===e.currentLang)})},initFilters(e){const n=h("filter-list");if(!n)return;n.innerHTML="";const r=e.translations[e.currentLang].categories;Object.keys(r).forEach(l=>{const s=document.createElement("div");s.className=`filter-item ${e.Config.excluded.has(l)?"active":""}`,s.textContent=r[l],s.onclick=()=>{s.classList.toggle("active")?e.Config.excluded.add(l):e.Config.excluded.delete(l),e.saveSettings(),this.triggerHaptic(30)},n.appendChild(s)}),document.querySelectorAll(".price-item").forEach(l=>{const s=l.dataset.price;l.classList.toggle("active",e.Config.prices.has(s)),l.onclick=()=>{l.classList.toggle("active")?e.Config.prices.add(s):e.Config.prices.delete(s),e.saveSettings(),this.triggerHaptic(30)}})},async showResult(e,n,r={}){const{fromShare:l=!1}=r;this.showScreen("result-screen"),e.Data.lastPickedId=n.place_id,e.Data.history||(e.Data.history=[]),e.Data.history.includes(n.place_id)||e.Data.history.push(n.place_id),e.Data.currentPlace=n;const s=e.translations[e.currentLang],o={name:h("res-name"),rating:h("res-rating"),ratingCont:h("res-rating-container"),price:h("res-price"),priceCont:h("res-price-container"),cat:h("res-category"),catIcon:h("res-category-icon"),catCont:h("res-category-container"),hours:h("res-hours"),hoursCont:h("res-hours-container"),address:h("res-address"),mapCont:h("res-map-container"),phone:h("res-phone"),distance:h("res-distance"),distanceCont:h("res-distance-container"),mapsBtn:h("open-maps-btn")};o.name.textContent=n.name,o.address.textContent=n.vicinity,l||h("result-screen").scrollIntoView({behavior:"smooth",block:"start"});const c=typeof n.rating=="number"&&n.rating>0;o.rating.textContent=c?n.rating:s.ratingNew.replace(/â­\s*/,"");const d=this.getPriceDisplay(n.priceLevel,s);o.price.textContent=d,o.priceCont.style.display=d?"flex":"none";const i=this.getPlaceCategory(n,e);if(i){const P=i.match(new RegExp("^(\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F)\\s*(.*)$","u"));o.catIcon.textContent=P?P[1]:"ðŸ´",o.cat.textContent=P?P[2]:i,o.catCont.style.display="flex"}else o.catCont.style.display="none";const m=this.getTodayHours(n,e);o.hours.textContent=m,o.hoursCont.style.display=m?"flex":"none",n.durationText?(o.distance.textContent=n.durationText,o.distanceCont.style.display="flex"):o.distanceCont.style.display="none",n.phone?(o.phone.textContent=`ðŸ“ž ${n.phone}`,o.phone.href=`tel:${n.phone.replace(/\s+/g,"")}`,o.phone.style.display=""):o.phone.style.display="none",o.mapsBtn.href=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(n.name)}&query_place_id=${n.place_id}`,this.renderMap(o.mapCont,n,e),l||this.triggerConfetti()},async renderMap(e,n,r){if(!n.location){e.style.display="none";return}e.classList.add("skeleton"),e.style.display="block";try{const[{Map:l},{AdvancedMarkerElement:s,PinElement:o}]=await Promise.all([google.maps.importLibrary("maps"),google.maps.importLibrary("marker")]),c=new l(e,{center:n.location,zoom:16,mapId:"DEMO_MAP_ID",disableDefaultUI:!1,mapTypeControl:!1,streetViewControl:!1,gestureHandling:"greedy",colorScheme:"FOLLOW_SYSTEM"}),d=new s({map:c,position:n.location,title:n.name});if(r.Data.userPos){const i=document.createElement("div");i.style.width="16px",i.style.height="16px",i.style.backgroundColor="#4285F4",i.style.border="2px solid white",i.style.borderRadius="50%",i.style.boxShadow="0 0 4px rgba(0,0,0,0.3)",new s({map:c,position:r.Data.userPos,title:"Your Location",content:i});const m=new google.maps.LatLngBounds;m.extend(n.location),m.extend(r.Data.userPos),c.fitBounds(m,50)}google.maps.event.addListenerOnce(c,"idle",()=>e.classList.remove("skeleton"))}catch(l){console.error("Map Render Error:",l),e.style.display="none"}},startSlotAnimation(e){const n=h("slot-name");let r=0;const l=setInterval(()=>{const s=e.Data.candidates[Math.floor(Math.random()*e.Data.candidates.length)];n.textContent=s?.name||"...",++r>15&&(clearInterval(l),oe(e))},100)},getPlaceCategory(e,n){const r=n.translations[n.currentLang].categories,l=(e.name||"").toLowerCase(),s=e.types||[];for(const[o,c]of Object.entries(ee))if(c.some(d=>l.includes(d)||s.some(i=>i.toLowerCase().includes(d))))return r[o];return null},getPriceDisplay(e,n){if(e==null)return"";let r=e;H[r]&&(r=H[r]);const l=te[r];return l?l.label(n):""},getTodayHours(e,n){const r=e.openingHours?.weekdayDescriptions;if(!r||r.length!==7)return"";const l=new Date,o={zh:"zh-HK",en:"en-US",ja:"ja-JP"}[n.currentLang]||"zh-HK",c=l.toLocaleDateString(o,{weekday:"long"}),d=l.toLocaleDateString("en-US",{weekday:"long"});let i=r.find(m=>m.includes(c)||m.includes(d));if(i||(i=r[l.getDay()]),i){const m=i.split(/: |ï¼š/);return m[1]?m[1].trim():i}return""},triggerHaptic(e){navigator.vibrate&&navigator.vibrate(e||30)},triggerConfetti(){Ne({particleCount:150,spread:70,origin:{y:.6},colors:["#ff6b81","#ffd32a","#2ecc71","#3498db"]})},async shareCurrentPlace(e){const n=e.Data.currentPlace;if(!n)return;const r=e.translations[e.currentLang],l=`${window.location.origin}${window.location.pathname}?resId=${n.place_id}${e.Data.userPos?`&lat=${e.Data.userPos.lat}&lng=${e.Data.userPos.lng}`:""}`,s=r.shareText.replace("${name}",n.name);if(navigator.share)try{await navigator.share({title:n.name,text:s,url:l})}catch(o){console.log("Share failed",o)}else try{await navigator.clipboard.writeText(`${s}
${l}`);const o=e.currentLang==="zh"?"å·²è¤‡è£½é€£çµåˆ°å‰ªè²¼ç°¿ï¼ðŸ“‹":e.currentLang==="ja"?"ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼ðŸ“‹":"Link copied to clipboard! ðŸ“‹";alert(o)}catch{alert(l)}}},Be="modulepreload",Ue=function(e){return"/"+e},A={},$e=function(n,r,l){let s=Promise.resolve();if(r&&r.length>0){let m=function(P){return Promise.all(P.map(C=>Promise.resolve(C).then(k=>({status:"fulfilled",value:k}),k=>({status:"rejected",reason:k}))))};var c=m;document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),i=d?.nonce||d?.getAttribute("nonce");s=m(r.map(P=>{if(P=Ue(P),P in A)return;A[P]=!0;const C=P.endsWith(".css"),k=C?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${P}"]${k}`))return;const x=document.createElement("link");if(x.rel=C?"stylesheet":Be,C||(x.as="script"),x.crossOrigin="",x.href=P,i&&x.setAttribute("nonce",i),document.head.appendChild(x),C)return new Promise((U,$)=>{x.addEventListener("load",U),x.addEventListener("error",()=>$(new Error(`Unable to preload CSS for ${P}`)))})}))}function o(d){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=d,window.dispatchEvent(i),!i.defaultPrevented)throw d}return s.then(d=>{for(const i of d||[])i.status==="rejected"&&o(i.reason);return n().catch(o)})};function He(e={}){const{immediate:n=!1,onNeedRefresh:r,onOfflineReady:l,onRegistered:s,onRegisteredSW:o,onRegisterError:c}=e;let d,i;const m=async(C=!0)=>{await i};async function P(){if("serviceWorker"in navigator){if(d=await $e(async()=>{const{Workbox:C}=await import("./workbox-window.prod.es5-BIl4cyR9.js");return{Workbox:C}},[]).then(({Workbox:C})=>new C("/sw.js",{scope:"/",type:"classic"})).catch(C=>{c?.(C)}),!d)return;d.addEventListener("activated",C=>{(C.isUpdate||C.isExternal)&&window.location.reload()}),d.addEventListener("installed",C=>{C.isUpdate||l?.()}),d.register({immediate:n}).then(C=>{o?o("/sw.js",C):s?.(C)}).catch(C=>{c?.(C)})}}return i=P(),m}const Ve={deferredPrompt:null,init(e,n){"serviceWorker"in navigator&&He({immediate:!0,onNeedRefresh(){console.log("New content available, reload to update.")},onOfflineReady(){console.log("App ready to work offline")}}),window.addEventListener("beforeinstallprompt",l=>{l.preventDefault(),this.deferredPrompt=l,h("install-container")&&!this.isIOS()&&h("install-container").classList.remove("hidden")}),window.addEventListener("appinstalled",()=>{this.deferredPrompt=null,h("install-container")&&h("install-container").classList.add("hidden")});const r=h("install-btn");r&&(r.addEventListener("click",()=>this.handleInstall()),this.isIOS()&&!this.isStandalone()&&(h("install-container").classList.remove("hidden"),r.innerHTML=`<span>${e[n].iosInstallText}</span>`,r.classList.add("ios-guide")))},isIOS(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream},isStandalone(){return window.navigator.standalone||window.matchMedia("(display-mode: standalone)").matches},async handleInstall(){if(this.isIOS()){alert(window.App.translations[window.App.currentLang].iosInstallAlert);return}if(!this.deferredPrompt)return;this.deferredPrompt.prompt();const{outcome:e}=await this.deferredPrompt.userChoice;this.deferredPrompt=null,h("install-container")&&h("install-container").classList.add("hidden")}},N={Config:{mins:parseInt(localStorage.getItem("currentMins")||"5"),includeClosed:localStorage.getItem("includeClosed")==="true",get radius(){return this.mins*80},excluded:new Set(JSON.parse(localStorage.getItem("excludedTypes")||"[]")),prices:new Set(JSON.parse(localStorage.getItem("selectedPrices")||'["1","2","3","4"]')),lang:(function(){let n=new URLSearchParams(window.location.search).get("lang")||localStorage.getItem("preferredLang");if(n&&(n.startsWith("zh")&&(n="zh"),n.startsWith("ja")&&(n="ja"),["zh","en","ja"].includes(n)))return n;const r=navigator.language||navigator.userLanguage;return r.startsWith("ja")?"ja":r.startsWith("zh")?"zh":"en"})()},Data:{userPos:null,manualLocation:null,candidates:[],currentPlace:null,lastPickedId:null,history:[],params:new URLSearchParams(window.location.search)},UI:Fe,PWA:Ve,translations:xe,get currentLang(){return this.Config.lang},saveSettings(){localStorage.setItem("currentMins",this.Config.mins.toString()),localStorage.setItem("includeClosed",this.Config.includeClosed),localStorage.setItem("selectedPrices",JSON.stringify(Array.from(this.Config.prices))),localStorage.setItem("excludedTypes",JSON.stringify(Array.from(this.Config.excluded)))},setLanguage(e){if(this.currentLang===e)return;localStorage.setItem("preferredLang",e),this.saveSettings();let n=window.location.pathname+"?lang="+e;!h("result-screen").classList.contains("hidden")&&this.Data.lastPickedId&&(n+="&resId="+this.Data.lastPickedId,this.Data.userPos&&(n+=`&lat=${this.Data.userPos.lat}&lng=${this.Data.userPos.lng}`)),window.location.href=n},init(){this.UI.updateStrings(this),this.UI.initFilters(this),this.setupEventListeners(),this.PWA.init(this.translations,this.currentLang),Oe(this),this.initLocationSearch()},async initLocationSearch(){const e=h("location-input"),n=h("location-bar"),r=h("location-display"),l=h("clear-location");if(!e||!n||!r||!l)return;const s=this.translations[this.currentLang];r.textContent=s.useCurrentLocation,n.onclick=c=>{c.target.closest(".clear-icon")||(n.classList.add("hidden"),e.classList.remove("hidden"),e.focus())};const o=()=>{setTimeout(()=>{e.classList.add("hidden"),n.classList.remove("hidden")},200)};e.onblur=o,l.onclick=c=>{c.stopPropagation(),this.Data.manualLocation=null,e.value="",r.textContent=s.useCurrentLocation,l.classList.add("hidden"),this.UI.triggerHaptic(30)};try{const{Autocomplete:c}=await google.maps.importLibrary("places"),d=new c(e,{fields:["geometry","name"],types:["geocode","establishment"]});d.addListener("place_changed",()=>{const i=d.getPlace();!i.geometry||!i.geometry.location||(this.Data.manualLocation={lat:i.geometry.location.lat(),lng:i.geometry.location.lng(),name:i.name},r.textContent="ðŸ“ "+i.name,l.classList.remove("hidden"),e.value=i.name,o(),this.UI.triggerHaptic(50))})}catch(c){console.error("Autocomplete init failed:",c)}},setupEventListeners(){const e=h("find-btn");e&&(e.onclick=()=>ne(this));const n=h("retry-btn");n&&(n.onclick=()=>oe(this));const r=h("share-btn");r&&(r.onclick=()=>this.UI.shareCurrentPlace(this));const l=h("back-btn");l&&(l.onclick=()=>this.UI.showScreen("main-flow")),document.querySelectorAll(".lang-selector span").forEach(c=>{c.onclick=()=>this.setLanguage(c.dataset.lang)});const s=h("distance-slider");s&&(s.value=this.Config.mins,s.oninput=function(){const c=parseInt(this.value);N.Config.mins=c,h("distance-val").textContent=c,N.saveSettings(),N.UI.triggerHaptic(10)});const o=h("include-closed-btn");o&&(o.onclick=()=>{N.Config.includeClosed=!N.Config.includeClosed,N.saveSettings(),N.UI.updateStrings(N),N.UI.triggerHaptic(30)})}};document.addEventListener("DOMContentLoaded",()=>{N.init()});
