(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function s(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(r){if(r.ep)return;r.ep=!0;const l=s(r);fetch(r.href,l)}})();const Ne={zh:{title:"é£Ÿä¹œå¥½",subtitle:"å””çŸ¥é£Ÿå’©ï¼Ÿç­‰æˆ‘å¹«ä½ æ€ï¼",distanceTitle:"æƒ³æµå¾’æ­¥å¹¾è€ï¼Ÿ",priceTitle:"åƒ¹éŒ¢é ç®—ï¼Ÿ",filterTitle:"ä»Šæ—¥å””æƒ³é£Ÿå’©ï¼Ÿ",findBtn:"å¹«æˆ‘æ€ï¼âœ¨",openMaps:"ðŸ—ºï¸ å–º Google Maps æ‰“é–‹",retry:"ðŸŽ² å””å¤šä¸­æ„ï¼ŸæŠ½éŽé–“ï¼",backBtn:"ðŸ  è¿”åŽ»ä¸»é ",loading:"æœå°‹ç·Šé™„è¿‘å¥½å˜¢é£Ÿ... ðŸ”",noResults:"é™„è¿‘æµå””åˆ°é–‹é–€å˜…é¤å»³ï¼Œè©¦ä¸‹æµé å•²ï¼Ÿ",noFilteredResults:"æµå””åˆ°ç¬¦åˆç¯©é¸æ¢ä»¶å˜…é¤å»³ï¼Œè©¦ä¸‹èª¿æ•´ä¸‹ã€Œä»Šæ—¥å””æƒ³é£Ÿå’©ã€ï¼ŸðŸ”",geoError:"æ‹Žå””åˆ°ä½ å€‹ä½ç½®ï¼Œè«‹æª¢æŸ¥ä¸‹æ¬Šé™ã€‚ðŸ“",noGeo:"ä½ å€‹ç€è¦½å™¨å””æ”¯æ´å–ç”¨åœ°ç†ä½ç½®ã€‚",locationTitle:"æƒ³æµé‚Šé ­ï¼Ÿ",searchPlaceholder:"ðŸ” æœå°‹åœ°é»ž",useCurrentLocation:"ðŸ“ ä½¿ç”¨ç•¶å‰ä½ç½®",installBtn:"å®‰è£ App ðŸ“²",iosInstallText:"é»žæ“ŠæŸ¥çœ‹ã€Œå®‰è£ Appã€æ•™å­¸ ðŸ“²",iosInstallAlert:`æƒ³å¥½ä¼¼ App å’ç”¨ã€Œé£Ÿä¹œå¥½ã€ï¼Ÿ

1. æ’³ç€è¦½å™¨åº•éƒ¨åˆ†äº«é¸å–® (æ­£æ–¹å½¢å‘ä¸Šç®­é ­)
2. å‘ä¸ŠæŽƒä¸¦é»žé¸ã€ŒåŠ å…¥ä¸»ç•«é¢ã€(Add to Home Screen)

æžæŽ‚ï¼âœ¨`,categories:{chinese:"ðŸš ä¸­é¤",japanese:"ðŸ£ æ—¥æœ¬èœ",korean:"ðŸ‡°ðŸ‡· éŸ“åœ‹èœ",western:"ðŸ• è¥¿é¤",se_asian:"ðŸ² æ±å—äºž",noodles:"ðŸœ ç²‰éºµ",spicy:"ðŸŒ¶ï¸ è¾£å˜¢",hotpot_bbq:"ðŸ”¥ ç«é‹/ç‡’çƒ¤",dim_sum:"ðŸ¥Ÿ é»žå¿ƒ/é£²èŒ¶",dessert:"ðŸ§ ç”œå“/ç³–æ°´",fast_food:"ðŸ” å¿«é¤/å°é£Ÿ",cafe_light:"â˜• å’–å•¡/è¼•é£Ÿ"},unknownName:"åç¨±ä¸è©³",noAddress:"åœ°å€ä¸è©³",ratingNew:"â­ æ–°é–‹å¼µï¼",priceFree:"å…è²»",walkMins:"æ­¥è¡Œç´„ ${mins} åˆ†é˜",shareBtn:"ðŸ“¤ åˆ†äº«é¤å»³",shareText:"æˆ‘å–ºã€Œé£Ÿä¹œå¥½ã€æŠ½ä¸­å’—å‘¢é–“ï¼š${name}ï¼ä¸€é½ŠåŽ»è©¦ä¸‹ï¼ŸðŸ¥—",includeClosed:"åŒ…å«å·²é—œé–€é¤å»³ ðŸŒ™",excludeClosed:"åªé¸ç‡Ÿæ¥­ä¸­é¤å»³ â˜€ï¸",reviews:"é£Ÿè©•",viewAllReviews:"æŸ¥çœ‹å…¨éƒ¨",photosTitle:"ç›¸ç‰‡",viewAllPhotos:"æŸ¥çœ‹å…¨éƒ¨"},en:{title:"What to Eat",subtitle:"Don't know? Let me pick!",distanceTitle:"Walking Distance",priceTitle:"Price Range",filterTitle:"What do you NOT want to eat?",findBtn:"Pick for me! âœ¨",openMaps:"ðŸ—ºï¸ Open in Google Maps",retry:"ðŸŽ² Not this one? Re-roll!",backBtn:"ðŸ  Back to Home",loading:"Searching for delicious food... ðŸ”",noResults:"No open restaurants found nearby. Try moving a bit?",noFilteredResults:"No restaurants match your filters. Try adjusting them! ðŸ”",geoError:"Unable to find location. Check permissions.",noGeo:"Geolocation not supported by this browser.",locationTitle:"Where to eat?",searchPlaceholder:"ðŸ” Search Location",useCurrentLocation:"ðŸ“ Use Current Location",installBtn:"Install App ðŸ“²",iosInstallText:"How to Install App ðŸ“²",iosInstallAlert:`Want to use 'What to Eat' like an App?

1. Tap the Share button in Safari (square with up arrow)
2. Scroll down and tap 'Add to Home Screen'

All set! âœ¨`,categories:{chinese:"ðŸš Chinese",japanese:"ðŸ£ Japanese",korean:"ðŸ‡°ðŸ‡· Korean",western:"ðŸ• Western",se_asian:"ðŸ² SE Asian",noodles:"ðŸœ Noodles",spicy:"ðŸŒ¶ï¸ Spicy",hotpot_bbq:"ðŸ”¥ Hotpot/BBQ",dim_sum:"ðŸ¥Ÿ Dim Sum",dessert:"ðŸ§ Dessert",fast_food:"ðŸ” Fast Food",cafe_light:"â˜• Cafe/Light"},unknownName:"Unknown",noAddress:"Address Unknown",ratingNew:"â­ New!",priceFree:"Free",walkMins:"ðŸš¶ ${mins} min walk",shareBtn:"ðŸ“¤ Share",shareText:"I picked this on What to Eat: ${name}! Want to try? ðŸ¥—",includeClosed:"Includes Closed Restaurants ðŸŒ™",excludeClosed:"Open Restaurants Only â˜€ï¸",reviews:"Reviews",viewAllReviews:"View All",photosTitle:"Photos",viewAllPhotos:"View All"},ja:{title:"ãƒ¡ã‚·æ±º",subtitle:"è¿·ã£ãŸã‚‰ã€ç§ã«é¸ã°ã›ã¦ï¼",distanceTitle:"å¾’æ­©ä½•åˆ†ï¼Ÿ",priceTitle:"äºˆç®—ã¯ï¼Ÿ",filterTitle:"ä»Šã¯é£Ÿã¹ãŸããªã„ã‚‚ã®ã¯ï¼Ÿ",findBtn:"é¸ã‚“ã§ï¼ âœ¨",openMaps:"ðŸ—ºï¸ Googleãƒžãƒƒãƒ—ã§é–‹ã",retry:"ðŸŽ² ä»–ã®ãŒã„ã„ï¼",backBtn:"ðŸ  ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹",loading:"è¿‘ãã®ç¾Žå‘³ã—ã„åº—ã‚’æŽ¢ã—ã¦ã„ã¾ã™... ðŸ”",noResults:"è¿‘ãã«å–¶æ¥­ä¸­ã®åº—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚",noFilteredResults:"æ¡ä»¶ã«åˆã†åº—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’èª¿æ•´ã—ã¦ã¿ã¦ãã ã•ã„ã€‚ðŸ”",geoError:"ä½ç½®æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã€‚è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚",noGeo:"ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ä½ç½®æƒ…å ±ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚",locationTitle:"ã©ã®è¾ºã§é£Ÿã¹ã‚‹ï¼Ÿ",searchPlaceholder:"ðŸ” å ´æ‰€ã‚’æ¤œç´¢",useCurrentLocation:"ðŸ“ ç¾åœ¨åœ°ã‚’ä½¿ç”¨",installBtn:"ã‚¢ãƒ—ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ðŸ“²",iosInstallText:"ã‚¢ãƒ—ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³• ðŸ“²",iosInstallAlert:`ã€Œä½•é£Ÿã¹ã‚‹ï¼Ÿã€ã‚’ã‚¢ãƒ—ãƒªã®ã‚ˆã†ã«ä½¿ã†æ–¹æ³•ï¼š

1. Safari ã®å…±æœ‰ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆå››è§’ã«ä¸ŠçŸ¢å°ï¼‰ã‚’ã‚¿ãƒƒãƒ—
2. ä¸‹ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ã‚’ã‚¿ãƒƒãƒ—

å®Œäº†ã§ã™ï¼âœ¨`,categories:{chinese:"ðŸš ä¸­è¯æ–™ç†",japanese:"ðŸ£ æ—¥æœ¬æ–™ç†",korean:"ðŸ‡°ðŸ‡· éŸ“å›½æ–™ç†",western:"ðŸ• æ´‹é£Ÿ",se_asian:"ðŸ² æ±å—äºž",noodles:"ðŸœ éººé¡ž",spicy:"ðŸŒ¶ï¸ è¾›ã„æ–™ç†",hotpot_bbq:"ðŸ”¥ ç«é‹/ç„¼è‚‰",dim_sum:"ðŸ¥Ÿ ç‚¹å¿ƒ",dessert:"ðŸ§ ãƒ‡ã‚¶ãƒ¼ãƒˆ",fast_food:"ðŸ” ãƒ•ã‚¡ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰",cafe_light:"â˜• ã‚«ãƒ•ã‚§/è»½é£Ÿ"},unknownName:"ä¸æ˜Ž",noAddress:"ä½æ‰€ä¸æ˜Ž",ratingNew:"â­ æ–°è¦ã‚ªãƒ¼ãƒ—ãƒ³ï¼",priceFree:"ç„¡æ–™",walkMins:"ðŸš¶ å¾’æ­© ${mins} åˆ†",shareBtn:"ðŸ“¤ ã‚·ã‚§ã‚¢",shareText:"ã€Œãƒ¡ã‚·æ±ºã€ã§ã“ã‚Œã‚’é¸ã‚“ã ã‚ˆï¼š${name}ï¼ä¸€ç·’ã«ã©ã†ï¼ŸðŸ¥—",includeClosed:"å–¶æ¥­æ™‚é–“å¤–ã‚‚å«ã‚€ ðŸŒ™",excludeClosed:"å–¶æ¥­ä¸­ã®ã¿ â˜€ï¸",reviews:"å£ã‚³ãƒŸ",viewAllPhotos:"ã‚‚ã£ã¨è¦‹ã‚‹",photosTitle:"å†™çœŸ",viewAllReviews:"ã‚‚ã£ã¨è¦‹ã‚‹"}},u=e=>document.getElementById(e);function Oe(e={}){return new Promise((t,s)=>{if(!navigator.geolocation){s(new Error("GEOLOCATION_NOT_SUPPORTED"));return}navigator.geolocation.getCurrentPosition(t,s,{enableHighAccuracy:!0,timeout:5e3,maximumAge:0,...e})})}const J={chinese:["chinese_restaurant","asian_restaurant","chinese","cantonese","shanghainese","sichuan","dim sum","congee","ä¸­èœ","ä¸­å¼","ç²µèœ","é»žå¿ƒ","ç²¥"],japanese:["japanese_restaurant","sushi_restaurant","ramen_restaurant","japanese","sushi","ramen","izakaya","udon","soba","yakitori","tonkatsu","æ—¥æœ¬","å£½å¸","æ‹‰éºµ","å±…é…’å±‹","çƒå†¬","ç‡’é³¥"],korean:["korean_restaurant","korean","kimchi","bibimbap","bbq","éŸ“åœ‹","éŸ“å¼","æ³¡èœ","é£¯å·","éŸ“ç‡’"],western:["italian_restaurant","french_restaurant","american_restaurant","hamburger_restaurant","pizza_restaurant","steak_house","brazilian_restaurant","greek_restaurant","mediterranean_restaurant","mexican_restaurant","seafood_restaurant","spanish_restaurant","buffet_restaurant","fine_dining_restaurant","restaurant","bar_and_grill","vegan_restaurant","vegetarian_restaurant","lebanese_restaurant","turkish_restaurant","middle_eastern_restaurant","afghani_restaurant","african_restaurant","steak","italian","french","burger","pasta","pizza","western","mexican","spanish","è¥¿é¤","æ„å¼","æ³•å¼","æ¼¢å ¡","è–„é¤…","ç‰›æ‰’"],se_asian:["thai_restaurant","vietnamese_restaurant","indonesian_restaurant","thai","vietnamese","malaysian","singaporean","indonesian","æ³°åœ‹","è¶Šå—","æ˜Ÿé¦¬","å°å°¼","æ³°å¼","è¶Šå¼"],noodles:["ramen_restaurant","noodle","ramen","udon","pho","ç±³ç·š","æ‹‰éºµ","éºµ","ç²‰","æ²³"],spicy:["spicy","sichuan","mala","chili","indian_restaurant","å·èœ","éº»è¾£","è¾£","æ°´ç…®","é…¸è¾£"],hotpot_bbq:["barbecue_restaurant","steak_house","hot pot","hotpot","bbq","barbecue","grill","yakiniku","ç«é‹","é›žç…²","ç‡’è‚‰","éŸ“ç‡’","ç‡’çƒ¤","ä¸²ç‡’"],dim_sum:["chinese_restaurant","dim sum","yum cha","dumpling","é»žå¿ƒ","é£²èŒ¶","é¤ƒå­","ç›…é£¯"],dessert:["bakery","ice_cream_shop","dessert_restaurant","dessert_shop","confectionery","chocolate_factory","chocolate_shop","candy_store","donut_shop","dessert","sugar","sweet","bakery","cake","ice cream","ç³–æ°´","ç”œ","é›ªç³•","å†°","è›‹ç³•","é¤…"],fast_food:["fast_food_restaurant","hamburger_restaurant","sandwich_shop","fast food","food_court","mcdonald","kfc","burger","sandwich","å¿«é¤","å°é£Ÿ","æ¼¢å ¡","ä¸‰æ–‡æ²»"],cafe_light:["cafe","coffee_shop","bakery","breakfast_restaurant","brunch_restaurant","cafeteria","diner","juice_shop","meal_delivery","meal_takeaway","tea_house","bagel_shop","acai_shop","cafe","coffee","sandwich","salad","breakfast","brunch","è¼•é£Ÿ","å’–å•¡","æ²™å¾‹","æ—©é¤","æ—©åˆé¤","æ–‡é’"]},Z=["id","displayName","location","rating","userRatingCount","regularOpeningHours","priceLevel","businessStatus","types"],ie=["id","formattedAddress","regularOpeningHours","nationalPhoneNumber","photos","reviews","googleMapsURI"],le={PRICE_LEVEL_FREE:{val:"0",label:e=>e.priceFree},PRICE_LEVEL_INEXPENSIVE:{val:"1",label:()=>"$"},PRICE_LEVEL_MODERATE:{val:"2",label:()=>"$$"},PRICE_LEVEL_EXPENSIVE:{val:"3",label:()=>"$$$"},PRICE_LEVEL_VERY_EXPENSIVE:{val:"4",label:()=>"$$$$"}},z={0:"PRICE_LEVEL_FREE",1:"PRICE_LEVEL_INEXPENSIVE",2:"PRICE_LEVEL_MODERATE",3:"PRICE_LEVEL_EXPENSIVE",4:"PRICE_LEVEL_VERY_EXPENSIVE"},V={DEFAULT_SEARCH_RADIUS_MULTIPLIER:80,DEFAULT_MINS:5,HAPTIC_FEEDBACK_DURATION:{SHORT:30},METERS_PER_DEGREE_LAT:111320};function X(e,t){return{name:typeof e.displayName=="string"?e.displayName:e.displayName?.text||t.unknownName,rating:e.rating,userRatingCount:e.userRatingCount||0,vicinity:e.formattedAddress||e.vicinity||t.noAddress,place_id:e.id||e.place_id,id:e.id||e.place_id,types:e.types||[],priceLevel:e.priceLevel,phone:e.nationalPhoneNumber,businessStatus:e.businessStatus,location:e.location,openingHours:e.regularOpeningHours,isOpen:null,durationText:null,durationValue:null,photos:e.photos||[],reviews:e.reviews||[],googleMapsURI:e.googleMapsURI}}async function ce(e){e.UI.triggerHaptic(50),e.UI.showScreen("loading-screen"),e.Data.history=[];const t=e.translations[e.currentLang];try{let s;e.Data.manualLocation?s={coords:{latitude:e.Data.manualLocation.lat,longitude:e.Data.manualLocation.lng}}:s=await Oe();const{latitude:o,longitude:r}=s.coords;e.Data.userPos={lat:o,lng:r};const{Place:l}=await google.maps.importLibrary("places"),d=await de(l,e.Data.userPos,e.Config.radius,e.Config.excluded);if(!d||d.length===0){alert(t.noResults),e.UI.showScreen("main-flow");return}const c=await ue(d,e.Data.userPos,e);if(c.length===0){alert(t.noFilteredResults),e.UI.showScreen("main-flow");return}e.Data.candidates=c;const i=c[Math.floor(Math.random()*c.length)];e.Data.currentPlace=await he(l,i,e),e.UI.startSlotAnimation(e)}catch(s){console.error("Search Error:",s),Fe(s,t,e)}}async function de(e,t,s,o){const r=s*.6,l=r/V.METERS_PER_DEGREE_LAT,d=r/(V.METERS_PER_DEGREE_LAT*Math.cos(t.lat*Math.PI/180)),c=[{lat:t.lat,lng:t.lng},{lat:t.lat-l,lng:t.lng-d},{lat:t.lat+l,lng:t.lng-d},{lat:t.lat-l,lng:t.lng+d},{lat:t.lat+l,lng:t.lng+d}],i=[],g=new Set,_=[["asian_restaurant","chinese_restaurant","indian_restaurant","indonesian_restaurant","japanese_restaurant","korean_restaurant","ramen_restaurant","sushi_restaurant","thai_restaurant","vietnamese_restaurant","lebanese_restaurant","turkish_restaurant","middle_eastern_restaurant","afghani_restaurant","african_restaurant"],["american_restaurant","barbecue_restaurant","brazilian_restaurant","french_restaurant","greek_restaurant","italian_restaurant","mediterranean_restaurant","mexican_restaurant","pizza_restaurant","seafood_restaurant","spanish_restaurant","steak_house","buffet_restaurant","fine_dining_restaurant","restaurant","bar_and_grill","vegan_restaurant","vegetarian_restaurant"],["bakery","breakfast_restaurant","brunch_restaurant","cafe","cafeteria","coffee_shop","dessert_restaurant","dessert_shop","diner","donut_shop","fast_food_restaurant","food_court","hamburger_restaurant","ice_cream_shop","juice_shop","meal_delivery","meal_takeaway","sandwich_shop","tea_house","bagel_shop","acai_shop","confectionery","chocolate_factory","chocolate_shop","candy_store"]],f=async(R,v)=>{const D={locationRestriction:{center:R,radius:s},includedPrimaryTypes:v,fields:Z,maxResultCount:20,rankPreference:"DISTANCE"};try{const{places:A}=await e.searchNearby(D);return A||[]}catch(A){return console.warn("Fetch error:",A),[]}},L=R=>{let v=0;return R.forEach(D=>{D&&D.id&&!g.has(D.id)&&(g.add(D.id),i.push(D),v++)}),v},M=new Set;o&&o.forEach(R=>{const v=J[R];v&&H(v).forEach(D=>M.add(D))});function H(R){return R.filter(v=>v.includes("_")||/^[a-z]+$/.test(v))}for(const R of _){const v=R.filter($=>!M.has($));if(v.length===0)continue;const D=await f(c[0],v);if(L(D),D.length<20)continue;const A=await Promise.all([f(c[1],v),f(c[4],v)]);let W=0;if(A.forEach($=>{W+=L($)}),W===0)continue;(await Promise.all([f(c[2],v),f(c[3],v)])).forEach($=>L($))}return i}async function ue(e,t,s){const o=s.translations[s.currentLang];let l=(await Promise.all(e.map(async i=>{const g=X(i,o);try{g.openingHours?.periods&&(g.isOpen=Ue(g.openingHours.periods)),g.isOpen===null&&(g.isOpen=await i.isOpen()),g.isOpen===null&&(g.isOpen=g.openingHours?.openNow)}catch{g.isOpen=null}return g}))).filter(i=>i.businessStatus!=="OPERATIONAL"&&i.businessStatus?!1:s.Config.includeClosed?!0:i.isOpen!==!1);const d=await fe(t,l);let c=d.filter(i=>i.durationValue===null||i.durationValue/60<=s.Config.mins);return c.length===0&&(c=d.sort((i,g)=>(i.durationValue||9999)-(g.durationValue||9999)).slice(0,3)),c.filter(i=>{const g=(i.name||"").toLowerCase(),_=i.types||[];if(Array.from(s.Config.excluded).some(L=>(J[L]||[]).some(H=>g.includes(H)||_.some(R=>R.toLowerCase().includes(H)))))return!1;if(i.priceLevel!==void 0&&i.priceLevel!==null){let L=i.priceLevel;z[L]&&(L=z[L]);const M=le[L];if(M&&s.Config.prices.size>0&&!s.Config.prices.has(M.val))return!1}return!0})}function Ue(e){if(!e||!Array.isArray(e)||e.length===0)return null;if(e.length===1&&!e[0].close)return!0;const t=new Date,s=t.getDay()*1440+t.getHours()*60+t.getMinutes(),o=10080;for(const r of e){if(!r.open||!r.close)continue;const l=Number(r.open.day)*1440+Number(r.open.hour)*60+Number(r.open.minute);let d=Number(r.close.day)*1440+Number(r.close.hour)*60+Number(r.close.minute);if(d<=l&&(d+=o),s>=l&&s<d||s+o>=l&&s+o<d)return!0}return!1}async function he(e,t,s){if(!t||!t.place_id)return t;const o=`place_detail_${t.place_id}`,r=Date.now(),l=1440*60*1e3,d=c=>c&&c.map(i=>({...i,getURI:g=>i.cachedURI||""}));try{const c=localStorage.getItem(o);if(c){const{data:i,timestamp:g}=JSON.parse(c);if(r-g<l){i.photos&&(i.photos=d(i.photos)),delete i.durationText,delete i.durationValue,delete i.distanceText,delete i.distanceValue;const{durationText:_,durationValue:f}=t;return Object.assign(t,i),_&&(t.durationText=_),f&&(t.durationValue=f),t}}}catch(c){console.warn("Cache read error:",c)}try{const c=new e({id:t.place_id});await c.fetchFields({fields:[...Z,...ie]});const i=X(c,s.translations[s.currentLang]);c.photos&&c.photos.length>0&&(i.photos=c.photos.map(f=>({cachedURI:f.getURI({maxHeight:1e3}),widthPx:f.widthPx,heightPx:f.heightPx,authorAttributions:f.authorAttributions})));const{durationText:g,durationValue:_}=t;Object.assign(t,i),g&&(t.durationText=g),_&&(t.durationValue=_),localStorage.setItem(o,JSON.stringify({data:i,timestamp:r})),t.photos&&(t.photos=d(t.photos))}catch(c){console.error("Error fetching place details:",c)}return t}function Fe(e,t,s){e.message==="GEOLOCATION_NOT_SUPPORTED"?alert(t.noGeo):e.code===1?alert(t.geoError):alert("Error: "+e.message),s.UI.showScreen("main-flow")}async function fe(e,t){if(t.length===0)return[];const s=25,o=[];for(let d=0;d<t.length;d+=s)o.push(t.slice(d,d+s));const r=new google.maps.DistanceMatrixService;return(await Promise.all(o.map(d=>new Promise(c=>{r.getDistanceMatrix({origins:[e],destinations:d.map(i=>i.location),travelMode:google.maps.TravelMode.WALKING,unitSystem:google.maps.UnitSystem.METRIC},(i,g)=>{if(g!=="OK"){c(d.map(f=>({...f,durationText:null,durationValue:null})));return}const _=i.rows[0].elements;c(d.map((f,L)=>({...f,durationText:_[L].status==="OK"?_[L].duration.text:null,durationValue:_[L].status==="OK"?_[L].duration.value:null})))})})))).flat()}async function ge(e){if(e.UI.triggerHaptic([50,30,50]),e.Data.candidates.length===0)return ce(e);let t=e.Data.candidates;if(t.length>1){const l=new Set(e.Data.history||[]),d=t.filter(c=>!l.has(c.place_id));if(d.length>0)t=d;else if(e.Data.lastPickedId){const c=t.filter(i=>i.place_id!==e.Data.lastPickedId);c.length>0&&(t=c)}}let s=t[Math.floor(Math.random()*t.length)];const{Place:o}=await google.maps.importLibrary("places"),r=await he(o,s,e);e.UI.showResult(e,r)}async function Be(e){const t=e.Data.params.get("resId");if(t){window.history.replaceState({},document.title,window.location.pathname),e.UI.showScreen("loading-screen");try{const{Place:s}=await google.maps.importLibrary("places"),o=new s({id:t});await o.fetchFields({fields:[...Z,...ie]});const r=e.Data.params.get("lat"),l=e.Data.params.get("lng");r&&l&&(e.Data.userPos={lat:parseFloat(r),lng:parseFloat(l)});const d=e.translations[e.currentLang],c=X(o,d);if(e.Data.userPos&&c.location){const[i]=await fe(e.Data.userPos,[c]);c.durationValue=i.durationValue,c.durationText=i.durationText}if(e.Data.userPos){const i=await de(s,e.Data.userPos,e.Config.radius);i&&i.length>0&&(e.Data.candidates=await ue(i,e.Data.userPos,e))}e.UI.showResult(e,c,{fromShare:!0})}catch(s){console.error("Session restoration failed:",s),e.UI.showScreen("main-flow")}}}function He(){const e=()=>{const t=Date.now(),s=1440*60*1e3;let o=0;try{for(let r=0;r<localStorage.length;r++){const l=localStorage.key(r);if(l&&l.startsWith("place_detail_"))try{const d=localStorage.getItem(l);if(d){const{timestamp:c}=JSON.parse(d);t-c>s&&(localStorage.removeItem(l),o++,r--)}}catch{localStorage.removeItem(l)}}}catch(r){console.warn("Garbage collection failed:",r)}};"requestIdleCallback"in window?requestIdleCallback(e,{timeout:5e3}):setTimeout(e,2e3)}var Y={};(function e(t,s,o,r){var l=!!(t.Worker&&t.Blob&&t.Promise&&t.OffscreenCanvas&&t.OffscreenCanvasRenderingContext2D&&t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype.transferControlToOffscreen&&t.URL&&t.URL.createObjectURL),d=typeof Path2D=="function"&&typeof DOMMatrix=="function",c=(function(){if(!t.OffscreenCanvas)return!1;try{var a=new OffscreenCanvas(1,1),n=a.getContext("2d");n.fillRect(0,0,1,1);var h=a.transferToImageBitmap();n.createPattern(h,"no-repeat")}catch{return!1}return!0})();function i(){}function g(a){var n=s.exports.Promise,h=n!==void 0?n:t.Promise;return typeof h=="function"?new h(a):(a(i,i),null)}var _=(function(a,n){return{transform:function(h){if(a)return h;if(n.has(h))return n.get(h);var p=new OffscreenCanvas(h.width,h.height),w=p.getContext("2d");return w.drawImage(h,0,0),n.set(h,p),p},clear:function(){n.clear()}}})(c,new Map),f=(function(){var a=Math.floor(16.666666666666668),n,h,p={},w=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(n=function(y){var C=Math.random();return p[C]=requestAnimationFrame(function m(b){w===b||w+a-1<b?(w=b,delete p[C],y()):p[C]=requestAnimationFrame(m)}),C},h=function(y){p[y]&&cancelAnimationFrame(p[y])}):(n=function(y){return setTimeout(y,a)},h=function(y){return clearTimeout(y)}),{frame:n,cancel:h}})(),L=(function(){var a,n,h={};function p(w){function y(C,m){w.postMessage({options:C||{},callback:m})}w.init=function(m){var b=m.transferControlToOffscreen();w.postMessage({canvas:b},[b])},w.fire=function(m,b,I){if(n)return y(m,null),n;var P=Math.random().toString(36).slice(2);return n=g(function(S){function T(x){x.data.callback===P&&(delete h[P],w.removeEventListener("message",T),n=null,_.clear(),I(),S())}w.addEventListener("message",T),y(m,P),h[P]=T.bind(null,{data:{callback:P}})}),n},w.reset=function(){w.postMessage({reset:!0});for(var m in h)h[m](),delete h[m]}}return function(){if(a)return a;if(!o&&l){var w=["var CONFETTI, SIZE = {}, module = {};","("+e.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{a=new Worker(URL.createObjectURL(new Blob([w])))}catch(y){return typeof console<"u"&&typeof console.warn=="function"&&console.warn("ðŸŽŠ Could not load worker",y),null}p(a)}return a}})(),M={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function H(a,n){return n?n(a):a}function R(a){return a!=null}function v(a,n,h){return H(a&&R(a[n])?a[n]:M[n],h)}function D(a){return a<0?0:Math.floor(a)}function A(a,n){return Math.floor(Math.random()*(n-a))+a}function W(a){return parseInt(a,16)}function Q(a){return a.map($)}function $(a){var n=String(a).replace(/[^0-9a-f]/gi,"");return n.length<6&&(n=n[0]+n[0]+n[1]+n[1]+n[2]+n[2]),{r:W(n.substring(0,2)),g:W(n.substring(2,4)),b:W(n.substring(4,6))}}function me(a){var n=v(a,"origin",Object);return n.x=v(n,"x",Number),n.y=v(n,"y",Number),n}function pe(a){a.width=document.documentElement.clientWidth,a.height=document.documentElement.clientHeight}function we(a){var n=a.getBoundingClientRect();a.width=n.width,a.height=n.height}function ve(a){var n=document.createElement("canvas");return n.style.position="fixed",n.style.top="0px",n.style.left="0px",n.style.pointerEvents="none",n.style.zIndex=a,n}function ye(a,n,h,p,w,y,C,m,b){a.save(),a.translate(n,h),a.rotate(y),a.scale(p,w),a.arc(0,0,1,C,m,b),a.restore()}function _e(a){var n=a.angle*(Math.PI/180),h=a.spread*(Math.PI/180);return{x:a.x,y:a.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:a.startVelocity*.5+Math.random()*a.startVelocity,angle2D:-n+(.5*h-Math.random()*h),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:a.color,shape:a.shape,tick:0,totalTicks:a.ticks,decay:a.decay,drift:a.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:a.gravity*3,ovalScalar:.6,scalar:a.scalar,flat:a.flat}}function Ce(a,n){n.x+=Math.cos(n.angle2D)*n.velocity+n.drift,n.y+=Math.sin(n.angle2D)*n.velocity+n.gravity,n.velocity*=n.decay,n.flat?(n.wobble=0,n.wobbleX=n.x+10*n.scalar,n.wobbleY=n.y+10*n.scalar,n.tiltSin=0,n.tiltCos=0,n.random=1):(n.wobble+=n.wobbleSpeed,n.wobbleX=n.x+10*n.scalar*Math.cos(n.wobble),n.wobbleY=n.y+10*n.scalar*Math.sin(n.wobble),n.tiltAngle+=.1,n.tiltSin=Math.sin(n.tiltAngle),n.tiltCos=Math.cos(n.tiltAngle),n.random=Math.random()+2);var h=n.tick++/n.totalTicks,p=n.x+n.random*n.tiltCos,w=n.y+n.random*n.tiltSin,y=n.wobbleX+n.random*n.tiltCos,C=n.wobbleY+n.random*n.tiltSin;if(a.fillStyle="rgba("+n.color.r+", "+n.color.g+", "+n.color.b+", "+(1-h)+")",a.beginPath(),d&&n.shape.type==="path"&&typeof n.shape.path=="string"&&Array.isArray(n.shape.matrix))a.fill(Ee(n.shape.path,n.shape.matrix,n.x,n.y,Math.abs(y-p)*.1,Math.abs(C-w)*.1,Math.PI/10*n.wobble));else if(n.shape.type==="bitmap"){var m=Math.PI/10*n.wobble,b=Math.abs(y-p)*.1,I=Math.abs(C-w)*.1,P=n.shape.bitmap.width*n.scalar,S=n.shape.bitmap.height*n.scalar,T=new DOMMatrix([Math.cos(m)*b,Math.sin(m)*b,-Math.sin(m)*I,Math.cos(m)*I,n.x,n.y]);T.multiplySelf(new DOMMatrix(n.shape.matrix));var x=a.createPattern(_.transform(n.shape.bitmap),"no-repeat");x.setTransform(T),a.globalAlpha=1-h,a.fillStyle=x,a.fillRect(n.x-P/2,n.y-S/2,P,S),a.globalAlpha=1}else if(n.shape==="circle")a.ellipse?a.ellipse(n.x,n.y,Math.abs(y-p)*n.ovalScalar,Math.abs(C-w)*n.ovalScalar,Math.PI/10*n.wobble,0,2*Math.PI):ye(a,n.x,n.y,Math.abs(y-p)*n.ovalScalar,Math.abs(C-w)*n.ovalScalar,Math.PI/10*n.wobble,0,2*Math.PI);else if(n.shape==="star")for(var E=Math.PI/2*3,k=4*n.scalar,N=8*n.scalar,O=n.x,B=n.y,j=5,U=Math.PI/j;j--;)O=n.x+Math.cos(E)*N,B=n.y+Math.sin(E)*N,a.lineTo(O,B),E+=U,O=n.x+Math.cos(E)*k,B=n.y+Math.sin(E)*k,a.lineTo(O,B),E+=U;else a.moveTo(Math.floor(n.x),Math.floor(n.y)),a.lineTo(Math.floor(n.wobbleX),Math.floor(w)),a.lineTo(Math.floor(y),Math.floor(C)),a.lineTo(Math.floor(p),Math.floor(n.wobbleY));return a.closePath(),a.fill(),n.tick<n.totalTicks}function be(a,n,h,p,w){var y=n.slice(),C=a.getContext("2d"),m,b,I=g(function(P){function S(){m=b=null,C.clearRect(0,0,p.width,p.height),_.clear(),w(),P()}function T(){o&&!(p.width===r.width&&p.height===r.height)&&(p.width=a.width=r.width,p.height=a.height=r.height),!p.width&&!p.height&&(h(a),p.width=a.width,p.height=a.height),C.clearRect(0,0,p.width,p.height),y=y.filter(function(x){return Ce(C,x)}),y.length?m=f.frame(T):S()}m=f.frame(T),b=S});return{addFettis:function(P){return y=y.concat(P),I},canvas:a,promise:I,reset:function(){m&&f.cancel(m),b&&b()}}}function ee(a,n){var h=!a,p=!!v(n||{},"resize"),w=!1,y=v(n,"disableForReducedMotion",Boolean),C=l&&!!v(n||{},"useWorker"),m=C?L():null,b=h?pe:we,I=a&&m?!!a.__confetti_initialized:!1,P=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,S;function T(E,k,N){for(var O=v(E,"particleCount",D),B=v(E,"angle",Number),j=v(E,"spread",Number),U=v(E,"startVelocity",Number),Se=v(E,"decay",Number),Pe=v(E,"gravity",Number),Te=v(E,"drift",Number),ne=v(E,"colors",Q),Me=v(E,"ticks",Number),ae=v(E,"shapes"),xe=v(E,"scalar"),Re=!!v(E,"flat"),re=me(E),se=O,G=[],De=a.width*re.x,ke=a.height*re.y;se--;)G.push(_e({x:De,y:ke,angle:B,spread:j,startVelocity:U,color:ne[se%ne.length],shape:ae[A(0,ae.length)],ticks:Me,decay:Se,gravity:Pe,drift:Te,scalar:xe,flat:Re}));return S?S.addFettis(G):(S=be(a,G,b,k,N),S.promise)}function x(E){var k=y||v(E,"disableForReducedMotion",Boolean),N=v(E,"zIndex",Number);if(k&&P)return g(function(U){U()});h&&S?a=S.canvas:h&&!a&&(a=ve(N),document.body.appendChild(a)),p&&!I&&b(a);var O={width:a.width,height:a.height};m&&!I&&m.init(a),I=!0,m&&(a.__confetti_initialized=!0);function B(){if(m){var U={getBoundingClientRect:function(){if(!h)return a.getBoundingClientRect()}};b(U),m.postMessage({resize:{width:U.width,height:U.height}});return}O.width=O.height=null}function j(){S=null,p&&(w=!1,t.removeEventListener("resize",B)),h&&a&&(document.body.contains(a)&&document.body.removeChild(a),a=null,I=!1)}return p&&!w&&(w=!0,t.addEventListener("resize",B,!1)),m?m.fire(E,O,j):T(E,O,j)}return x.reset=function(){m&&m.reset(),S&&S.reset()},x}var q;function te(){return q||(q=ee(null,{useWorker:!0,resize:!0})),q}function Ee(a,n,h,p,w,y,C){var m=new Path2D(a),b=new Path2D;b.addPath(m,new DOMMatrix(n));var I=new Path2D;return I.addPath(b,new DOMMatrix([Math.cos(C)*w,Math.sin(C)*w,-Math.sin(C)*y,Math.cos(C)*y,h,p])),I}function Le(a){if(!d)throw new Error("path confetti are not supported in this browser");var n,h;typeof a=="string"?n=a:(n=a.path,h=a.matrix);var p=new Path2D(n),w=document.createElement("canvas"),y=w.getContext("2d");if(!h){for(var C=1e3,m=C,b=C,I=0,P=0,S,T,x=0;x<C;x+=2)for(var E=0;E<C;E+=2)y.isPointInPath(p,x,E,"nonzero")&&(m=Math.min(m,x),b=Math.min(b,E),I=Math.max(I,x),P=Math.max(P,E));S=I-m,T=P-b;var k=10,N=Math.min(k/S,k/T);h=[N,0,0,N,-Math.round(S/2+m)*N,-Math.round(T/2+b)*N]}return{type:"path",path:n,matrix:h}}function Ie(a){var n,h=1,p="#000000",w='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof a=="string"?n=a:(n=a.text,h="scalar"in a?a.scalar:h,w="fontFamily"in a?a.fontFamily:w,p="color"in a?a.color:p);var y=10*h,C=""+y+"px "+w,m=new OffscreenCanvas(y,y),b=m.getContext("2d");b.font=C;var I=b.measureText(n),P=Math.ceil(I.actualBoundingBoxRight+I.actualBoundingBoxLeft),S=Math.ceil(I.actualBoundingBoxAscent+I.actualBoundingBoxDescent),T=2,x=I.actualBoundingBoxLeft+T,E=I.actualBoundingBoxAscent+T;P+=T+T,S+=T+T,m=new OffscreenCanvas(P,S),b=m.getContext("2d"),b.font=C,b.fillStyle=p,b.fillText(n,x,E);var k=1/h;return{type:"bitmap",bitmap:m.transferToImageBitmap(),matrix:[k,0,0,k,-P*k/2,-S*k/2]}}s.exports=function(){return te().apply(this,arguments)},s.exports.reset=function(){te().reset()},s.exports.create=ee,s.exports.shapeFromPath=Le,s.exports.shapeFromText=Ie})((function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}})(),Y,!1);const K=Y.exports;Y.exports.create;const Ve={showScreen(e){["main-flow","result-screen","loading-screen"].forEach(l=>{const d=u(l);d&&d.classList.toggle("hidden",l!==e)});const s=u("footer-home"),o=u("footer-result"),r=u("app-footer");e==="main-flow"?(r&&r.classList.remove("hidden"),s&&s.classList.remove("hidden"),o&&o.classList.add("hidden")):e==="result-screen"?(r&&r.classList.remove("hidden"),s&&s.classList.add("hidden"),o&&o.classList.remove("hidden")):r&&r.classList.add("hidden")},updateStrings(e){const t=e.translations[e.currentLang],s={"location-title":t.locationTitle,"app-title":t.title,"app-subtitle":t.subtitle,"price-title":t.priceTitle,"filter-title":t.filterTitle,"find-btn":t.findBtn,"retry-btn":t.retry,"back-btn":t.backBtn,"loading-text":t.loading,"open-maps-btn":t.openMaps,"share-btn":t.shareBtn,"install-btn":t.installBtn,"reviews-title":t.reviews,"view-all-reviews":t.viewAllReviews,"photos-title":t.photosTitle,"view-all-photos":t.viewAllPhotos};Object.entries(s).forEach(([c,i])=>{const g=u(c);g&&(g.textContent=i)});const o=u("location-input");o&&(o.placeholder=t.searchPlaceholder);const r=u("location-display");r&&!e.Data.manualLocation&&(r.textContent=t.useCurrentLocation);const l=u("distance-title");if(l){l.textContent="",l.appendChild(document.createTextNode(`${t.distanceTitle} (`));const c=document.createElement("span");c.id="distance-val",c.textContent=e.Config.mins,l.appendChild(c),l.appendChild(document.createTextNode(" mins)"))}const d=u("include-closed-btn");if(d){const c=e.Config.includeClosed;d.classList.toggle("active",c);const i=u("include-closed-label");i&&(i.textContent=c?t.includeClosed:t.excludeClosed)}document.querySelectorAll(".lang-selector span").forEach(c=>{c.classList.toggle("active",c.dataset.lang===e.currentLang)})},initFilters(e){const t=u("filter-list");if(!t)return;t.innerHTML="";const s=e.translations[e.currentLang].categories;Object.keys(s).forEach(o=>{const r=document.createElement("div");r.className=`filter-item ${e.Config.excluded.has(o)?"active":""}`,r.textContent=s[o],r.onclick=()=>{e.Config.excluded.has(o)?(e.Config.excluded.delete(o),r.classList.remove("active")):(e.Config.excluded.add(o),r.classList.add("active")),e.saveSettings(),this.triggerHaptic(V.HAPTIC_FEEDBACK_DURATION.SHORT)},t.appendChild(r)}),document.querySelectorAll(".price-item").forEach(o=>{const r=o.dataset.price;o.classList.toggle("active",e.Config.prices.has(r)),o.onclick=()=>{e.Config.prices.has(r)?(e.Config.prices.delete(r),o.classList.remove("active")):(e.Config.prices.add(r),o.classList.add("active")),e.saveSettings(),this.triggerHaptic(V.HAPTIC_FEEDBACK_DURATION.SHORT)}})},async showResult(e,t,s={}){const{fromShare:o=!1}=s;this.showScreen("result-screen"),this.updateHistory(e,t),e.Data.currentPlace=t;const r=this.getElements();this.renderHeader(r,t,o),this.renderPhotos(r,t),this.renderReviews(r,t),this.renderDetails(r,t,e),this.renderMap(r.mapCont,t,e),o||this.triggerConfetti()},updateHistory(e,t){e.Data.lastPickedId=t.place_id,e.Data.history||(e.Data.history=[]),e.Data.history.includes(t.place_id)||e.Data.history.push(t.place_id)},getElements(){return{name:u("res-name"),rating:u("res-rating"),ratingCont:u("res-rating-container"),price:u("res-price"),priceCont:u("res-price-container"),cat:u("res-category"),catIcon:u("res-category-icon"),catCont:u("res-category-container"),hours:u("res-hours"),hoursCont:u("res-hours-container"),address:u("res-address"),mapCont:u("res-map-container"),phone:u("res-phone"),distance:u("res-distance"),distanceCont:u("res-distance-container"),mapsBtn:u("open-maps-btn"),photoCont:u("res-photo-container"),photoSection:u("res-photo-section"),photosViewAll:u("view-all-photos"),reviewsViewAll:u("view-all-reviews"),reviewsCont:u("res-reviews-container"),reviewsList:u("reviews-list")}},renderHeader(e,t,s){if(e.name&&(e.name.textContent=t.name),e.address&&(e.address.textContent=t.vicinity),e.reviewsViewAll&&(e.reviewsViewAll.href=t.googleMapsURI||"#"),e.photosViewAll&&(e.photosViewAll.href=t.googleMapsURI||"#"),!s){const o=u("result-screen");o&&o.scrollIntoView({behavior:"smooth",block:"start"})}},renderPhotos(e,t){if(e.photoSection)if(t.photos&&t.photos.length>0){if(e.photoSection.classList.remove("hidden"),e.photoCont){e.photoCont.innerHTML="";const s=document.createDocumentFragment();t.photos.forEach(o=>{const r=document.createElement("img");r.src=o.getURI({maxHeight:400}),r.className="photo-item",r.alt=t.name,r.loading="lazy",r.style.opacity="0",r.style.transition="opacity 0.3s ease",r.onload=()=>{r.style.opacity="1"},r.onerror=function(){this.getAttribute("data-retried")?this.style.display="none":(this.setAttribute("data-retried","true"),setTimeout(()=>{const l=this.src.includes("?")?"&":"?";this.src=this.src+l+"retry="+Date.now()},1e3))},r.onclick=()=>window.open(r.src,"_blank"),s.appendChild(r)}),e.photoCont.appendChild(s)}}else e.photoSection.classList.add("hidden")},renderReviews(e,t){if(!(!e.reviewsCont||!e.reviewsList))if(t.reviews&&t.reviews.length>0){e.reviewsCont.classList.remove("hidden"),e.reviewsList.innerHTML="",e.reviewsList.scrollLeft=0;const s=t.reviews.filter(o=>o.text&&(o.text.text||o.text).length>0).sort((o,r)=>{const l=o.publishTime?new Date(o.publishTime).getTime():0;return(r.publishTime?new Date(r.publishTime).getTime():0)-l});if(s.length===0)e.reviewsCont.classList.add("hidden");else{const o=document.createDocumentFragment();s.forEach(r=>{const l=document.createElement("div");l.className="review-item";const d="â­".repeat(Math.round(r.rating||0)),c=r.relativePublishTimeDescription||"",i=document.createElement("div");i.className="review-top";const g=document.createElement("span");g.className="review-author",g.textContent=r.authorAttribution?.displayName||"Anonymous";const _=document.createElement("span");_.className="review-time",_.textContent=c,i.appendChild(g),i.appendChild(_);const f=document.createElement("div");f.className="review-stars",f.textContent=d;const L=document.createElement("p");L.className="review-text",L.textContent=r.text?.text||r.text||"",l.appendChild(i),l.appendChild(f),l.appendChild(L),o.appendChild(l)}),e.reviewsList.appendChild(o)}}else e.reviewsCont.classList.add("hidden")},renderDetails(e,t,s){const o=s.translations[s.currentLang],r=typeof t.rating=="number"&&t.rating>0;e.rating&&(e.rating.textContent=r?t.rating:o.ratingNew.replace(/â­\s*/,""));const l=this.getPriceDisplay(t.priceLevel,o);e.price&&(e.price.textContent=l),e.priceCont&&(e.priceCont.style.display=l?"flex":"none");const d=this.getPlaceCategory(t,s);if(d){const i=d.match(new RegExp("^(\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F)\\s*(.*)$","u"));e.catIcon&&(e.catIcon.textContent=i?i[1]:"ðŸ´"),e.cat&&(e.cat.textContent=i?i[2]:d),e.catCont&&(e.catCont.style.display="flex")}else e.catCont&&(e.catCont.style.display="none");const c=this.getTodayHours(t,s);e.hours&&(e.hours.textContent=c),e.hoursCont&&(e.hoursCont.style.display=c?"flex":"none"),t.durationText?(e.distance&&(e.distance.textContent=t.durationText),e.distanceCont&&(e.distanceCont.style.display="flex")):e.distanceCont&&(e.distanceCont.style.display="none"),t.phone?e.phone&&(e.phone.textContent=`ðŸ“ž ${t.phone}`,e.phone.href=`tel:${t.phone.replace(/\s+/g,"")}`,e.phone.style.display=""):e.phone&&(e.phone.style.display="none"),e.mapsBtn&&(e.mapsBtn.href=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(t.name)}&query_place_id=${t.place_id}`)},async renderMap(e,t,s){if(e){if(!t.location){e.style.display="none";return}e.classList.add("skeleton"),e.style.display="block";try{const[{Map:o},{AdvancedMarkerElement:r}]=await Promise.all([google.maps.importLibrary("maps"),google.maps.importLibrary("marker")]),l=new o(e,{center:t.location,zoom:16,mapId:"DEMO_MAP_ID",disableDefaultUI:!1,mapTypeControl:!1,streetViewControl:!1,gestureHandling:"greedy",colorScheme:"FOLLOW_SYSTEM"});if(new r({map:l,position:t.location,title:t.name}),s.Data.userPos){const d=document.createElement("div");d.style.width="16px",d.style.height="16px",d.style.backgroundColor="#4285F4",d.style.border="2px solid white",d.style.borderRadius="50%",d.style.boxShadow="0 0 4px rgba(0,0,0,0.3)",new r({map:l,position:s.Data.userPos,title:"Your Location",content:d});const c=new google.maps.LatLngBounds;c.extend(t.location),c.extend(s.Data.userPos),l.fitBounds(c,50)}google.maps.event.addListenerOnce(l,"idle",()=>e.classList.remove("skeleton"))}catch(o){console.error("Map Render Error:",o),e.style.display="none"}}},startSlotAnimation(e){const t=u("slot-name");if(!t)return;let s=0;const o=setInterval(()=>{const r=e.Data.candidates[Math.floor(Math.random()*e.Data.candidates.length)];t.textContent=r?.name||"...",++s>15&&(clearInterval(o),ge(e))},100)},getPlaceCategory(e,t){const s=t.translations[t.currentLang].categories,o=(e.name||"").toLowerCase(),r=e.types||[];for(const[l,d]of Object.entries(J))if(d.some(c=>o.includes(c)||r.some(i=>i.toLowerCase().includes(c))))return s[l];return null},getPriceDisplay(e,t){if(e==null)return"";let s=e;z[s]&&(s=z[s]);const o=le[s];return o?o.label(t):""},getTodayHours(e,t){const s=e.openingHours?.weekdayDescriptions;if(!s||s.length!==7)return"";const o=new Date,l={zh:"zh-HK",en:"en-US",ja:"ja-JP"}[t.currentLang]||"zh-HK",d=o.toLocaleDateString(l,{weekday:"long"}),c=o.toLocaleDateString("en-US",{weekday:"long"});let i=s.find(g=>g.includes(d)||g.includes(c));if(i||(i=s[o.getDay()]),i){const g=i.split(/: |ï¼š/);return g[1]?g[1].trim():i}return""},triggerHaptic(e){navigator.vibrate&&navigator.vibrate(e||V.HAPTIC_FEEDBACK_DURATION.SHORT)},triggerConfetti(){(K.create?K.create():K)({particleCount:150,spread:70,origin:{y:.6},colors:["#ff6b81","#ffd32a","#2ecc71","#3498db"]})},async shareCurrentPlace(e){const t=e.Data.currentPlace;if(!t)return;const s=e.translations[e.currentLang],o=`${window.location.origin}${window.location.pathname}?resId=${t.place_id}${e.Data.userPos?`&lat=${e.Data.userPos.lat}&lng=${e.Data.userPos.lng}`:""}`,r=s.shareText.replace("${name}",t.name);if(navigator.share)try{await navigator.share({title:t.name,text:r,url:o})}catch(l){console.log("Share failed",l)}else try{await navigator.clipboard.writeText(`${r}
${o}`);const l=e.currentLang==="zh"?"å·²è¤‡è£½é€£çµåˆ°å‰ªè²¼ç°¿ï¼ðŸ“‹":e.currentLang==="ja"?"ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼ðŸ“‹":"Link copied to clipboard! ðŸ“‹";alert(l)}catch{alert(o)}}},Ae="modulepreload",$e=function(e){return"/"+e},oe={},je=function(t,s,o){let r=Promise.resolve();if(s&&s.length>0){let g=function(_){return Promise.all(_.map(f=>Promise.resolve(f).then(L=>({status:"fulfilled",value:L}),L=>({status:"rejected",reason:L}))))};var d=g;document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),i=c?.nonce||c?.getAttribute("nonce");r=g(s.map(_=>{if(_=$e(_),_ in oe)return;oe[_]=!0;const f=_.endsWith(".css"),L=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${_}"]${L}`))return;const M=document.createElement("link");if(M.rel=f?"stylesheet":Ae,f||(M.as="script"),M.crossOrigin="",M.href=_,i&&M.setAttribute("nonce",i),document.head.appendChild(M),f)return new Promise((H,R)=>{M.addEventListener("load",H),M.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${_}`)))})}))}function l(c){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=c,window.dispatchEvent(i),!i.defaultPrevented)throw c}return r.then(c=>{for(const i of c||[])i.status==="rejected"&&l(i.reason);return t().catch(l)})};function We(e={}){const{immediate:t=!1,onNeedRefresh:s,onOfflineReady:o,onRegistered:r,onRegisteredSW:l,onRegisterError:d}=e;let c,i;const g=async(f=!0)=>{await i};async function _(){if("serviceWorker"in navigator){if(c=await je(async()=>{const{Workbox:f}=await import("./workbox-window.prod.es5-BIl4cyR9.js");return{Workbox:f}},[]).then(({Workbox:f})=>new f("/sw.js",{scope:"/",type:"classic"})).catch(f=>{d?.(f)}),!c)return;c.addEventListener("activated",f=>{(f.isUpdate||f.isExternal)&&window.location.reload()}),c.addEventListener("installed",f=>{f.isUpdate||o?.()}),c.register({immediate:t}).then(f=>{l?l("/sw.js",f):r?.(f)}).catch(f=>{d?.(f)})}}return i=_(),g}const ze={deferredPrompt:null,init(e,t){"serviceWorker"in navigator&&We({immediate:!0,onNeedRefresh(){console.log("New content available, reloading..."),window.location.reload()},onOfflineReady(){console.log("App ready to work offline")}}),window.addEventListener("beforeinstallprompt",o=>{o.preventDefault(),this.deferredPrompt=o,u("install-container")&&!this.isIOS()&&u("install-container").classList.remove("hidden")}),window.addEventListener("appinstalled",()=>{this.deferredPrompt=null,u("install-container")&&u("install-container").classList.add("hidden")});const s=u("install-btn");s&&(s.addEventListener("click",()=>this.handleInstall()),this.isIOS()&&!this.isStandalone()&&(u("install-container").classList.remove("hidden"),s.innerHTML=`<span>${e[t].iosInstallText}</span>`,s.classList.add("ios-guide")))},isIOS(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream},isStandalone(){return window.navigator.standalone||window.matchMedia("(display-mode: standalone)").matches},async handleInstall(){if(this.isIOS()){alert(window.App.translations[window.App.currentLang].iosInstallAlert);return}if(!this.deferredPrompt)return;this.deferredPrompt.prompt();const{outcome:e}=await this.deferredPrompt.userChoice;this.deferredPrompt=null,u("install-container")&&u("install-container").classList.add("hidden")}},F={Config:{mins:parseInt(localStorage.getItem("currentMins")||V.DEFAULT_MINS.toString()),includeClosed:localStorage.getItem("includeClosed")==="true",get radius(){return this.mins*V.DEFAULT_SEARCH_RADIUS_MULTIPLIER},excluded:new Set(JSON.parse(localStorage.getItem("excludedTypes")||"[]")),prices:new Set(JSON.parse(localStorage.getItem("selectedPrices")||'["1","2","3","4"]')),lang:(function(){let t=new URLSearchParams(window.location.search).get("lang")||localStorage.getItem("preferredLang");if(t&&(t.startsWith("zh")&&(t="zh"),t.startsWith("ja")&&(t="ja"),["zh","en","ja"].includes(t)))return t;const s=navigator.language||navigator.userLanguage;return s.startsWith("ja")?"ja":s.startsWith("zh")?"zh":"en"})()},Data:{userPos:null,manualLocation:null,candidates:[],currentPlace:null,lastPickedId:null,history:[],params:new URLSearchParams(window.location.search)},UI:Ve,PWA:ze,translations:Ne,get currentLang(){return this.Config.lang},saveSettings(){localStorage.setItem("currentMins",this.Config.mins.toString()),localStorage.setItem("includeClosed",this.Config.includeClosed),localStorage.setItem("selectedPrices",JSON.stringify(Array.from(this.Config.prices))),localStorage.setItem("excludedTypes",JSON.stringify(Array.from(this.Config.excluded)))},setLanguage(e){if(this.currentLang===e)return;localStorage.setItem("preferredLang",e),this.saveSettings();let t=window.location.pathname+"?lang="+e;!u("result-screen").classList.contains("hidden")&&this.Data.lastPickedId&&(t+="&resId="+this.Data.lastPickedId,this.Data.userPos&&(t+=`&lat=${this.Data.userPos.lat}&lng=${this.Data.userPos.lng}`)),window.location.href=t},init(){He(),this.UI.updateStrings(this),this.UI.initFilters(this),this.setupEventListeners(),this.PWA.init(this.translations,this.currentLang),Be(this),this.initLocationSearch()},async initLocationSearch(){const e=u("location-input"),t=u("location-bar"),s=u("location-display"),o=u("clear-location");if(!e||!t||!s||!o)return;const r=this.translations[this.currentLang];s.textContent=r.useCurrentLocation,t.onclick=d=>{d.target.closest(".clear-icon")||(t.classList.add("hidden"),e.classList.remove("hidden"),e.focus())};const l=()=>{setTimeout(()=>{e.classList.add("hidden"),t.classList.remove("hidden")},200)};e.onblur=l,o.onclick=d=>{d.stopPropagation(),this.Data.manualLocation=null,e.value="",s.textContent=r.useCurrentLocation,o.classList.add("hidden"),this.UI.triggerHaptic(30)};try{const{Autocomplete:d}=await google.maps.importLibrary("places"),c=new d(e,{fields:["geometry","name"],types:["geocode","establishment"]});c.addListener("place_changed",()=>{const i=c.getPlace();!i.geometry||!i.geometry.location||(this.Data.manualLocation={lat:i.geometry.location.lat(),lng:i.geometry.location.lng(),name:i.name},s.textContent="ðŸ“ "+i.name,o.classList.remove("hidden"),e.value=i.name,l(),this.UI.triggerHaptic(50))})}catch{}},setupEventListeners(){const e=u("find-btn");e&&(e.onclick=()=>ce(this));const t=u("retry-btn");t&&(t.onclick=()=>ge(this));const s=u("share-btn");s&&(s.onclick=()=>this.UI.shareCurrentPlace(this));const o=u("back-btn");o&&(o.onclick=()=>this.UI.showScreen("main-flow")),document.querySelectorAll(".lang-selector span").forEach(d=>{d.onclick=()=>this.setLanguage(d.dataset.lang)});const r=u("distance-slider");r&&(r.value=this.Config.mins,r.oninput=function(){const d=parseInt(this.value);F.Config.mins=d,u("distance-val").textContent=d,F.saveSettings(),F.UI.triggerHaptic(10)});const l=u("include-closed-btn");l&&(l.onclick=()=>{F.Config.includeClosed=!F.Config.includeClosed,F.saveSettings(),F.UI.updateStrings(F),F.UI.triggerHaptic(V.HAPTIC_FEEDBACK_DURATION.SHORT)})}};document.addEventListener("DOMContentLoaded",()=>{F.init()});
